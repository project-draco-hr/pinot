{
  Map<String,StarTreeRecord> aggregates=new HashMap<String,StarTreeRecord>();
  for (  Text tsvRecord : tsvRecords) {
    StarTreeRecord record=toRecord(config,tsvRecord);
    StarTreeRecord aggregate=aggregates.get(record.getKey(true));
    if (aggregate == null || aggregate.getTime() < record.getTime()) {
      aggregates.put(record.getKey(true),record);
    }
 else     if (aggregate.getTime().equals(record.getTime())) {
      aggregates.put(record.getKey(true),StarTreeUtils.merge(Arrays.asList(record,aggregate)));
    }
  }
  for (  StarTreeRecord record : aggregates.values()) {
    outputTsvRecord.set(fromRecord(config,record));
    context.write(nodeId,outputTsvRecord);
  }
}
