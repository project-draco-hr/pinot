{
  Lock lock=collectionLocks.get(collection);
  if (lock == null) {
    collectionLocks.putIfAbsent(collection,new ReentrantLock());
    lock=collectionLocks.get(collection);
  }
  lock.lock();
  LOG.info("Locked collection {} using lock {} for data delete",collection,lock);
  try {
    final String dataDirPrefix=StorageUtils.getDataDirPrefix(schedule,minTime,maxTime);
    File collectionDir=new File(rootDir,collection);
    File[] matchingDirs=collectionDir.listFiles(new FilenameFilter(){
      @Override public boolean accept(      File dir,      String name){
        return name.startsWith(dataDirPrefix);
      }
    }
);
    if (matchingDirs == null || matchingDirs.length == 0) {
      throw new FileNotFoundException("No directory with prefix " + dataDirPrefix);
    }
    for (    File dataDir : matchingDirs) {
      FileUtils.forceDelete(dataDir);
      LOG.info("Deleted {}",dataDir);
    }
  }
  finally {
    lock.unlock();
    LOG.info("Unlocked collection {} using lock {} for data delete",collection,lock);
  }
}
