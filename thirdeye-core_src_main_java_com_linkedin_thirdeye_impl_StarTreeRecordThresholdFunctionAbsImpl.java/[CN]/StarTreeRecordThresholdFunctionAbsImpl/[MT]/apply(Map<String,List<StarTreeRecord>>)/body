{
  Set<String> passingValues=new HashSet<String>();
  for (  Map.Entry<String,List<StarTreeRecord>> sampleEntry : sample.entrySet()) {
    Map<String,Integer> aggregates=new HashMap<String,Integer>();
    for (    StarTreeRecord record : sampleEntry.getValue()) {
      for (      String metricName : metricThresholdValues.keySet()) {
        Number value=aggregates.get(metricName);
        if (value == null) {
          value=0;
        }
        Number sum=NumberUtils.sum(value,record.getMetricValues().get(metricName),"INT");
        aggregates.put(metricName,sum.intValue());
      }
    }
    boolean passes=true;
    for (    Map.Entry<String,Integer> thresholdEntry : metricThresholdValues.entrySet()) {
      Integer aggregateValue=aggregates.get(thresholdEntry.getKey());
      if (aggregateValue < thresholdEntry.getValue()) {
        passes=false;
        break;
      }
    }
    if (passes) {
      passingValues.add(sampleEntry.getKey());
    }
  }
  return passingValues;
}
