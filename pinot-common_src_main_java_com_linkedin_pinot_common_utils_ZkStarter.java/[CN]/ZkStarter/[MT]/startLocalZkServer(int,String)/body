{
  if (_zookeeperServerMain != null) {
    throw new RuntimeException("Zookeeper server is already started!");
  }
  try {
    _zookeeperServerMain=new PublicZooKeeperServerMain();
    _zkDataDir=dataDirPath;
    final String[] args=new String[]{Integer.toString(port),dataDirPath};
    new Thread(){
      @Override public void run(){
        try {
          _zookeeperServerMain.initializeAndRun(args);
        }
 catch (        QuorumPeerConfig.ConfigException e) {
          LOGGER.warn("Caught exception while starting ZK",e);
        }
catch (        IOException e) {
          LOGGER.warn("Caught exception while starting ZK",e);
        }
      }
    }
.start();
  }
 catch (  Exception e) {
    LOGGER.warn("Caught exception while starting ZK",e);
    throw new RuntimeException(e);
  }
  ZkClient client=new ZkClient("localhost:" + port,10000);
  client.waitUntilConnected(10L,TimeUnit.SECONDS);
  client.close();
}
