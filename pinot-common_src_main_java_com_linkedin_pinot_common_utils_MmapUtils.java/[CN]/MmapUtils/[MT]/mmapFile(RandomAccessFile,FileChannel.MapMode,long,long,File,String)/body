{
  String context;
  if (allocationContext != null) {
    context=allocationContext.getAbsolutePath() + " (" + details+ ")";
  }
 else {
    context="no file (" + details + ")";
  }
  MMAP_BUFFER_USAGE.addAndGet(size);
  if (LOGGER.isDebugEnabled()) {
    LOGGER.debug("Memory mapping file, mmap size {} with context {}, allocation after operation {}",size,context,getTrackedAllocationStatus());
  }
  MappedByteBuffer byteBuffer=null;
  try {
    byteBuffer=randomAccessFile.getChannel().map(mode,position,size);
  }
 catch (  Exception e) {
    LOGGER.error("Failed to mmap file (size {}, context {})",size,context,e);
    LOGGER.error("Allocation status {}",getTrackedAllocationStatus());
    Utils.rethrowException(e);
  }
  BUFFER_TO_CONTEXT_MAP.put(byteBuffer,new AllocationContext(context,AllocationType.MMAP));
  return byteBuffer;
}
