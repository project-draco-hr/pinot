{
  PinotResourceManagerResponse createBrokerResourceResp=null;
  if (!ControllerHelixHelper.getBrokerTagList(_helixAdmin,_helixClusterName).contains(brokerTagResource.getTag())) {
    createBrokerResourceResp=createBrokerResourceTag(brokerTagResource);
  }
 else   if (ControllerHelixHelper.getBrokerTag(_helixAdmin,_helixClusterName,brokerTagResource.getTag()).getNumBrokerInstances() < brokerTagResource.getNumBrokerInstances()) {
    createBrokerResourceResp=updateBrokerResourceTag(brokerTagResource);
  }
  if ((createBrokerResourceResp == null) || createBrokerResourceResp.isSuccessfull()) {
    createBrokerResourceResp=createBrokerDataResource(brokerDataResource);
    if (!createBrokerResourceResp.isSuccessfull()) {
      throw new UnsupportedOperationException("Failed to update broker resource : " + createBrokerResourceResp.errorMessage);
    }
  }
 else {
    throw new UnsupportedOperationException("Failed to create broker resource : " + createBrokerResourceResp.errorMessage);
  }
}
