{
  final String resourceName=segmentMetadata.getResourceName();
  final String segmentName=segmentMetadata.getName();
  final IdealState currentIdealState=_helixAdmin.getResourceIdealState(_helixClusterName,resourceName);
  final Set<String> currentInstanceSet=currentIdealState.getInstanceSet(segmentName);
  for (  final String instance : currentInstanceSet) {
    currentIdealState.setPartitionState(segmentName,instance,"OFFLINE");
  }
  _helixAdmin.setResourceIdealState(_helixClusterName,resourceName,currentIdealState);
  if (ifExternalViewChangeReflectedForState(resourceName,segmentName,"OFFLINE",_externalViewReflectTimeOut)) {
    throw new RuntimeException("Cannot get OFFLINE state to be reflected on ExternalView changed for segment: " + segmentName);
  }
  for (  final String instance : currentInstanceSet) {
    currentIdealState.setPartitionState(segmentName,instance,"ONLINE");
  }
  _helixAdmin.setResourceIdealState(_helixClusterName,resourceName,currentIdealState);
  if (ifExternalViewChangeReflectedForState(resourceName,segmentName,"ONLINE",_externalViewReflectTimeOut)) {
    throw new RuntimeException("Cannot get ONLINE state to be reflected on ExternalView changed for segment: " + segmentName);
  }
  return true;
}
