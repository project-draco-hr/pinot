{
  long externalViewChangeCompletedDeadline=System.currentTimeMillis() + timeoutMillis;
  deadlineLoop:   while (System.currentTimeMillis() < externalViewChangeCompletedDeadline) {
    Uninterruptibles.sleepUninterruptibly(2L,TimeUnit.SECONDS);
    ExternalView externalView=_helixAdmin.getResourceExternalView(_helixClusterName,tableName);
    Map<String,String> segmentStatsMap=externalView.getStateMap(segmentName);
    if (segmentStatsMap != null) {
      for (      String instance : segmentStatsMap.keySet()) {
        final String segmentState=segmentStatsMap.get(instance);
        if (!segmentState.equalsIgnoreCase(targetState)) {
          if ("ERROR".equalsIgnoreCase(segmentState) && !considerErrorStateAsDifferentFromTarget) {
          }
 else {
            continue deadlineLoop;
          }
        }
      }
      return true;
    }
  }
  return false;
}
