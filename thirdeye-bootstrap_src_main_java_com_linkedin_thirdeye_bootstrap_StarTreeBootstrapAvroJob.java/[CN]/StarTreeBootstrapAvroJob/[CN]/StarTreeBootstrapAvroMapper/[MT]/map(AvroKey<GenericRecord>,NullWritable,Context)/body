{
  if (schema == null) {
    schema=record.datum().getSchema();
  }
  Map<UUID,StarTreeRecord> collector=new HashMap<UUID,StarTreeRecord>();
  collectRecords(starTree.getRoot(),toStarTreeRecord(starTree.getConfig(),record.datum()),collector);
  for (  Map.Entry<UUID,StarTreeRecord> entry : collector.entrySet()) {
    nodeId.set(entry.getKey().toString());
    outputRecord.datum(toGenericRecord(starTree.getConfig(),schema,entry.getValue(),outputRecord.datum()));
    context.write(nodeId,outputRecord);
  }
}
