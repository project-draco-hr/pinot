{
  lock.writeLock().lock();
  try {
    this.config=config;
    this.thresholdFunction=config.getThresholdFunction();
    if (this.recordStore == null && this.children.isEmpty()) {
      try {
        this.recordStoreFactory=config.getRecordStoreFactory();
        this.recordStore=recordStoreFactory.createRecordStore(nodeId);
        this.recordStore.open();
      }
 catch (      Exception e) {
        throw new IllegalStateException(e);
      }
    }
  }
  finally {
    lock.writeLock().unlock();
  }
}
