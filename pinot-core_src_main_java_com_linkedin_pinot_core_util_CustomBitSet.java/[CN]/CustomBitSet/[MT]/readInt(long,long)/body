{
  int bytePosition=Ints.checkedCast(startBitIndex >>> 3);
  int startBitOffset=Ints.checkedCast(startBitIndex & 7);
  long sum=startBitOffset + (endBitIndex - startBitIndex);
  int endBitOffset=Ints.checkedCast((8 - (sum & 7)) & 7);
  int numberOfBytesUsed=Ints.checkedCast((sum + 7) >>> 3);
  int i=-1;
  long number=0;
  while (true) {
    number|=(buf.get(bytePosition)) & 0xFF;
    i++;
    bytePosition++;
    if (i == numberOfBytesUsed - 1) {
      break;
    }
    number<<=8;
  }
  number>>=endBitOffset;
  number&=(0xFFFFFFFF >>> (32 - (endBitIndex - startBitIndex)));
  return (int)number;
}
