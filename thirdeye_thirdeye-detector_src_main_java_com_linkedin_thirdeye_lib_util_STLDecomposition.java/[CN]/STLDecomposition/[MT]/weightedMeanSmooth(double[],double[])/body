{
  double[] smoothed=new double[series.length];
  double mean=0;
  double sumOfWeights=0;
  for (int i=0; i < series.length; i++) {
    double weight=(weights != null) ? weights[i] : 1;
    mean+=weight * series[i];
    ;
    sumOfWeights+=weight;
  }
  if (sumOfWeights == 0) {
    for (int i=0; i < series.length; i++) {
      smoothed[i]=series[i];
    }
  }
 else {
    mean/=sumOfWeights;
    for (int i=0; i < series.length; i++) {
      smoothed[i]=mean;
    }
  }
  return smoothed;
}
