{
  Map<String,Integer> metricPosition=new HashMap<String,Integer>();
  for (int position=0; position < starTreeConfig.getMetrics().size(); position++) {
    metricPosition.put(starTreeConfig.getMetrics().get(position).getName(),position);
  }
  for (  Entry<String,List<ReportRow>> entry : metricTableRows.entrySet()) {
    List<ReportRow> tableRows=entry.getValue();
    String metric=entry.getKey();
    if (tableRows.size() == 0) {
      throw new IllegalStateException("No rows found for metric " + metric);
    }
    MetricTimeSeries currentSeries=new MetricTimeSeries(MetricSchema.fromMetricSpecs(starTreeConfig.getMetrics()));
    MetricTimeSeries baselineSeries=new MetricTimeSeries(MetricSchema.fromMetricSpecs(starTreeConfig.getMetrics()));
    ReportRow summary=new ReportRow(tableRows.get(0));
    if (metric.startsWith("RATIO")) {
      double currentSum=0;
      double baselineSum=0;
      for (int i=0; i < tableRows.size(); i++) {
        currentSum+=tableRows.get(i).getCurrent().doubleValue();
        baselineSum+=tableRows.get(i).getBaseline().doubleValue();
      }
      summary.setCurrent(currentSum);
      summary.setBaseline(baselineSum);
    }
 else {
      for (int i=0; i < tableRows.size(); i++) {
        currentSeries.set(i,metric,tableRows.get(i).getCurrent());
        baselineSeries.set(i,metric,tableRows.get(i).getBaseline());
      }
      summary.setCurrent(currentSeries.getMetricSums()[metricPosition.get(metric)]);
      summary.setBaseline(baselineSeries.getMetricSums()[metricPosition.get(metric)]);
    }
    summary.setRatio(DOUBLE_FORMAT.format((summary.getCurrent().doubleValue() - summary.getBaseline().doubleValue()) / (summary.getBaseline().doubleValue()) * 100));
    summary.setDimension("Total");
    tableRows.add(summary);
  }
}
