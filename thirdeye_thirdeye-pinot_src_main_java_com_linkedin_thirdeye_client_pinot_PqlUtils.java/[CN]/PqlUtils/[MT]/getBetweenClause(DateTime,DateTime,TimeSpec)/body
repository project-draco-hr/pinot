{
  String timeField=timeFieldSpec.getColumnName();
  if (TimeSpec.SINCE_EPOCH_FORMAT.equals(timeFieldSpec.getFormat())) {
    TimeGranularity dataGranularity=timeFieldSpec.getDataGranularity();
    long startInConvertedUnits=dataGranularity.convertToUnit(start.getMillis());
    long endInConvertedUnits=dataGranularity.convertToUnit(end.getMillis());
    if (startInConvertedUnits == endInConvertedUnits) {
      return String.format(" %s = %s",timeField,startInConvertedUnits);
    }
 else {
      return String.format(" %s >= %s AND %s < %s",timeField,startInConvertedUnits,timeField,endInConvertedUnits);
    }
  }
 else {
    SimpleDateFormat sdf=new SimpleDateFormat(timeFieldSpec.getFormat());
    String startDateTime=sdf.format(new Date(start.getMillis()));
    String endDateTime=sdf.format(new Date(start.getMillis()));
    if (startDateTime.equals(endDateTime)) {
      return String.format(" %s = %s",timeField,startDateTime);
    }
 else {
      return String.format(" %s >= %s AND %s < %s",timeField,startDateTime,timeField,endDateTime);
    }
  }
}
