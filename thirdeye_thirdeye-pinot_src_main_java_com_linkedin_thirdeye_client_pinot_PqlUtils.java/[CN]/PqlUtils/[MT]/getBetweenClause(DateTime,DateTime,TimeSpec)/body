{
  String timeField=timeFieldSpec.getColumnName();
  if (timeFieldSpec.getFormat() == null) {
    TimeGranularity bucket=timeFieldSpec.getBucket();
    long startInConvertedUnits=bucket.convertToUnit(start.getMillis());
    long endInConvertedUnits=bucket.convertToUnit(end.getMillis());
    return String.format(" %s >= %s AND %s < %s",timeField,startInConvertedUnits,timeField,endInConvertedUnits);
  }
 else {
    SimpleDateFormat sdf=new SimpleDateFormat(timeFieldSpec.getFormat());
    String startDateTime=sdf.format(new Date(start.getMillis()));
    String endDateTime=sdf.format(new Date(start.getMillis()));
    if (startDateTime.equals(endDateTime)) {
      return String.format(" %s = %s",timeField,startDateTime);
    }
 else {
      return String.format(" %s >= %s AND %s < %s",timeField,startDateTime,timeField,endDateTime);
    }
  }
}
