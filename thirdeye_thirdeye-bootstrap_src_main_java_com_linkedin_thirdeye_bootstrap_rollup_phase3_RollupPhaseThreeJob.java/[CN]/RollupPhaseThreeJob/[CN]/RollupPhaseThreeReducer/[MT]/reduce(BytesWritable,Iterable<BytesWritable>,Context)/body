{
  DimensionKey rawDimensionKey=null;
  MetricTimeSeries rawMetricTimeSeries=null;
  Map<DimensionKey,MetricTimeSeries> possibleRollupTimeSeriesMap=new HashMap<DimensionKey,MetricTimeSeries>();
  for (  BytesWritable writable : rollupReduceOutputWritableIterable) {
    RollupPhaseTwoReduceOutput temp;
    temp=RollupPhaseTwoReduceOutput.fromBytes(writable.copyBytes(),metricSchema);
    if (rawMetricTimeSeries == null) {
      rawDimensionKey=temp.getRawDimensionKey();
      rawMetricTimeSeries=temp.getRawTimeSeries();
    }
    possibleRollupTimeSeriesMap.put(temp.getRollupDimensionKey(),temp.getRollupTimeSeries());
  }
  DimensionKey selectedRollup=rollupFunc.rollup(rawDimensionKey,possibleRollupTimeSeriesMap,rollupThresholdFunction);
  if (selectedRollup == null)   throw new IllegalStateException("rollup function could not find any dimension combination that passes threshold");
  context.write(new BytesWritable(selectedRollup.toBytes()),new BytesWritable(rawMetricTimeSeries.toBytes()));
}
