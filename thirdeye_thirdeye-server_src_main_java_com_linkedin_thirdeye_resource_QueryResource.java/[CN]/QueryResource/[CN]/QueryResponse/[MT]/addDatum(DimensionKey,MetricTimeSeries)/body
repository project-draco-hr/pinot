{
  if (metrics == null) {
    throw new IllegalStateException("Must add metrics to query response first");
  }
  String key=OBJECT_MAPPER.writeValueAsString(dimensionKey.getDimensionValues());
  data.put(key,new HashMap<String,Number[]>());
  for (  Long time : timeSeries.getTimeWindowSet()) {
    Number[] values=new Number[timeSeries.getSchema().getNumMetrics()];
    for (int i=0; i < timeSeries.getSchema().getNumMetrics(); i++) {
      values[i]=timeSeries.get(time,timeSeries.getSchema().getMetricName(i));
    }
    DateTime dateTime=new DateTime(time);
    if (timeZone != null) {
      dateTime=dateTime.toDateTime(timeZone);
    }
    if (iso8601) {
      data.get(key).put(dateTime.toString(ISODateTimeFormat.dateTime()),values);
    }
 else {
      data.get(key).put(Long.toString(dateTime.getMillis()),values);
    }
  }
}
