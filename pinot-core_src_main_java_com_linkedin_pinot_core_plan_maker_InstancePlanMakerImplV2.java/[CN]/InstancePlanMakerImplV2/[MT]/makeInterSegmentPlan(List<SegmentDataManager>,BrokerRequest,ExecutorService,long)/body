{
  final InstanceResponsePlanNode rootNode=new InstanceResponsePlanNode();
  boolean enableNewAggregationGroupBy=_enableNewAggregationGroupByCfg;
  List<IndexSegment> segments=new ArrayList<>();
  for (  SegmentDataManager segmentDataManager : segmentDataManagers) {
    IndexSegment segment=segmentDataManager.getSegment();
    enableNewAggregationGroupBy&=isSegmentFitForNewAggregationGroupBy(segment,brokerRequest);
    segments.add(segment);
  }
  final CombinePlanNode combinePlanNode=new CombinePlanNode(brokerRequest,executorService,timeOutMs,enableNewAggregationGroupBy);
  rootNode.setPlanNode(combinePlanNode);
  for (  IndexSegment segment : segments) {
    combinePlanNode.addPlanNode(makeInnerSegmentPlan(segment,brokerRequest,enableNewAggregationGroupBy));
  }
  return new GlobalPlanImplV0(rootNode);
}
