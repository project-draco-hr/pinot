{
  Map<String,Number> aggregates=new HashMap<String,Number>();
  for (  MetricSpec spec : config.getMetrics()) {
    aggregates.put(spec.getName(),0);
  }
  for (  Iterable<StarTreeRecord> stream : streams) {
    for (    StarTreeRecord record : stream) {
      if (matches(record)) {
        updateAggregates(record,aggregates);
        if (debug) {
          printWriter.println(record);
        }
      }
    }
  }
  for (  MetricSpec spec : config.getMetrics()) {
    printWriter.print(spec.getName());
    printWriter.print("=");
    printWriter.print(aggregates.get(spec.getName()));
    printWriter.println();
  }
}
