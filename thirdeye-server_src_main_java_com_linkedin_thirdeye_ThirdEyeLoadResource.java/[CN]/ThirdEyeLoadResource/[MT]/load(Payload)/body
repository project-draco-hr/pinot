{
  final StarTreeConfig config=starTreeManager.getConfig(payload.getCollection());
  if (config == null) {
    throw new IllegalArgumentException("No collection " + payload.getCollection());
  }
  URI uri=URI.create(payload.getUri());
  Iterable<StarTreeRecord> recordStream;
  if ("file".equals(uri.getScheme())) {
    recordStream=new StarTreeRecordStreamTextStreamImpl(uri.toURL().openStream(),config.getDimensionNames(),config.getMetricNames(),"\t");
  }
 else   if ("avro".equals(uri.getScheme())) {
    recordStream=new StarTreeRecordStreamAvroFileImpl(new File(uri.getPath()),config.getDimensionNames(),config.getMetricNames(),config.getTimeColumnName());
  }
 else {
    throw new IllegalArgumentException("Invalid payload URI " + uri);
  }
  starTreeManager.load(payload.getCollection(),recordStream);
  return Response.ok().build();
}
