{
  if (_propertyStore == null) {
    return;
  }
  String resourceName=externalView.getResourceName();
  if (BrokerRequestUtils.getResourceTypeFromResourceName(resourceName) == ResourceType.REALTIME) {
    return;
  }
  Set<String> offlineSegmentsServing=externalView.getPartitionSet();
  OfflineDataResourceZKMetadata offlineDataResourceZKMetadata=ZKMetadataProvider.getOfflineResourceZKMetadata(_propertyStore,resourceName);
  TimeUnit resourceTimeUnit=getTimeUnitFromString(offlineDataResourceZKMetadata.getTimeType());
  if (!offlineSegmentsServing.isEmpty() && resourceTimeUnit != null) {
    long maxTimeValue=-1;
    for (    String segmentId : offlineSegmentsServing) {
      try {
        long endTime=-1;
        OfflineSegmentZKMetadata offlineSegmentZKMetadata=ZKMetadataProvider.getOfflineSegmentZKMetadata(_propertyStore,resourceName,segmentId);
        if (offlineSegmentZKMetadata.getEndTime() > 0) {
          if (offlineSegmentZKMetadata.getTimeUnit() != null) {
            endTime=resourceTimeUnit.convert(offlineSegmentZKMetadata.getEndTime(),offlineSegmentZKMetadata.getTimeUnit());
          }
 else {
            endTime=offlineSegmentZKMetadata.getEndTime();
          }
        }
        maxTimeValue=Math.max(maxTimeValue,endTime);
      }
 catch (      Exception e) {
        LOGGER.error("Error during convert end time for segment - " + segmentId + ", exceptions: "+ e);
      }
    }
    TimeBoundaryInfo timeBoundaryInfo=new TimeBoundaryInfo();
    timeBoundaryInfo.setTimeColumn(offlineDataResourceZKMetadata.getTimeColumnName());
    timeBoundaryInfo.setTimeValue(Long.toString(maxTimeValue));
    _timeBoundaryInfoMap.put(resourceName,timeBoundaryInfo);
  }
}
