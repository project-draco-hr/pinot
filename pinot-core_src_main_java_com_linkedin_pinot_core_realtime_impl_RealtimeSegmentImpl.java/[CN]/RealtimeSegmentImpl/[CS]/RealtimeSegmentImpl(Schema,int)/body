{
  dataSchema=schema;
  dictionaryMap=new HashMap<String,MutableDictionaryReader>();
  maxNumberOfMultivaluesMap=new HashMap<String,Integer>();
  incomingTimeColumnName=dataSchema.getTimeSpec().getIncomingTimeColumnName();
  outgoingTimeColumnName=dataSchema.getTimeSpec().getOutGoingTimeColumnName();
  this.capacity=capacity;
  for (  FieldSpec col : dataSchema.getAllFieldSpecs()) {
    maxNumberOfMultivaluesMap.put(col.getName(),0);
  }
  for (  String column : dataSchema.getDimensionNames()) {
    dictionaryMap.put(column,RealtimeDictionaryProvider.getDictionaryFor(dataSchema.getFieldSpecFor(column)));
  }
  dictionaryMap.put(outgoingTimeColumnName,RealtimeDictionaryProvider.getDictionaryFor(dataSchema.getFieldSpecFor(outgoingTimeColumnName)));
  for (  String metric : dataSchema.getMetricNames()) {
    dictionaryMap.put(metric,RealtimeDictionaryProvider.getDictionaryFor(dataSchema.getFieldSpecFor(metric)));
  }
  docIdGenerator=new AtomicInteger(-1);
  timeConverter=TimeConverterProvider.getTimeConverterFromGranularitySpecs(schema);
  columnIndexReaderWriterMap=new HashMap<String,DataFileReader>();
  invertedIndexMap=new HashMap<String,RealtimeInvertedIndex>();
  for (  String dimension : schema.getDimensionNames()) {
    invertedIndexMap.put(dimension,new DimensionInvertertedIndex(dimension));
    if (schema.getFieldSpecFor(dimension).isSingleValueField()) {
      columnIndexReaderWriterMap.put(dimension,new FixedByteSingleColumnSingleValueReaderWriter(capacity,V1Constants.Dict.INT_DICTIONARY_COL_SIZE));
    }
 else {
      columnIndexReaderWriterMap.put(dimension,new FixedByteSingleColumnMultiValueReaderWriter(capacity,Integer.SIZE / 8,FixedByteSingleColumnMultiValueReaderWriter.DEFAULT_MAX_NUMBER_OF_MULTIVALUES));
    }
  }
  for (  String metric : schema.getMetricNames()) {
    invertedIndexMap.put(metric,new MetricInvertedIndex(metric));
    columnIndexReaderWriterMap.put(metric,new FixedByteSingleColumnSingleValueReaderWriter(capacity,V1Constants.Dict.INT_DICTIONARY_COL_SIZE));
  }
  invertedIndexMap.put(outgoingTimeColumnName,new TimeInvertedIndex(outgoingTimeColumnName));
  columnIndexReaderWriterMap.put(outgoingTimeColumnName,new FixedByteSingleColumnSingleValueReaderWriter(capacity,V1Constants.Dict.INT_DICTIONARY_COL_SIZE));
}
