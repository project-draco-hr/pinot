{
  BrokerResponse brokerResponse=new BrokerResponse();
  List<List<AggregationResult>> aggregationResultsList=new ArrayList<List<AggregationResult>>();
  for (int i=0; i < brokerRequest.getAggregationsInfoSize(); ++i) {
    aggregationResultsList.add(new ArrayList<AggregationResult>());
  }
  for (  ServerInstance serverInstance : instanceResponseMap.keySet()) {
    InstanceResponse instanceResponse=instanceResponseMap.get(serverInstance);
    if (instanceResponse.getAggregationResults() != null) {
      for (int i=0; i < brokerRequest.getAggregationsInfoSize(); ++i) {
        aggregationResultsList.get(i).add(instanceResponse.getAggregationResults().get(i));
      }
    }
    reduceOnExceptions(brokerResponse.getExceptions(),serverInstance,instanceResponse.getExceptions());
    brokerResponse.setNumDocsScanned(brokerResponse.getNumDocsScanned() + instanceResponse.getNumDocsScanned());
    brokerResponse.setTotalDocs(brokerResponse.getTotalDocs() + instanceResponse.getTotalDocs());
  }
  return brokerResponse;
}
