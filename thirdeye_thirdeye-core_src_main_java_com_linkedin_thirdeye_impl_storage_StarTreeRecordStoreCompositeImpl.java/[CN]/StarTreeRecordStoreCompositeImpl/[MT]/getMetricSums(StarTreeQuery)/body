{
  Number[] fromImmutable=immutableStore.getMetricSums(query);
  Number[] fromMutable=mutableStore.getMetricSums(query);
  if (fromImmutable.length != fromMutable.length) {
    throw new IllegalStateException("Record stores have differing number of metrics");
  }
  if (fromImmutable.length != config.getMetrics().size()) {
    throw new IllegalStateException("Record store did not return " + config.getMetrics().size() + " metrics for "+ query);
  }
  for (int i=0; i < config.getMetrics().size(); i++) {
    fromImmutable[i]=NumberUtils.sum(fromImmutable[i],fromMutable[i],config.getMetrics().get(i).getType());
  }
  return fromImmutable;
}
