{
  KafkaSegmentMetadata kafkaSegmentMetadata=(KafkaSegmentMetadata)segmentMetadata;
  long startOffset=kafkaSegmentMetadata.getStartOffset();
  long endOffset=kafkaSegmentMetadata.getEndOffset();
  LOGGER.info("KafkaSegmentMetadataChangeListener.onChange()");
  if (endOffset > 0) {
    if (realtimeSegmentmanager.hasStarted() && !realtimeSegmentmanager.isClosed()) {
      realtimeSegmentmanager.pause();
      long currentOffset=realtimeSegmentmanager.getCurrentOffset();
      if (currentOffset <= endOffset) {
        realtimeSegmentmanager.setEndOffset(endOffset);
        realtimeSegmentmanager.start();
        realtimeSegmentmanager.waitUntilOffset(endOffset);
        realtimeSegmentmanager.shutdown();
        realtimeSegmentmanager.convertToOffline();
      }
 else       if (currentOffset > endOffset) {
        realtimeSegmentmanager.pause();
        realtimeSegmentmanager.reset();
        realtimeSegmentmanager.setEndOffset(endOffset);
        realtimeSegmentmanager.start();
        realtimeSegmentmanager.waitUntilOffset(endOffset);
      }
    }
  }
}
