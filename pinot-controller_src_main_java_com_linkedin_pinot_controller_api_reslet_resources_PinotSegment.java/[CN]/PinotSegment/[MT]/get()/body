{
  StringRepresentation presentation=null;
  try {
    final String resourceName=(String)getRequest().getAttributes().get("resourceName");
    final String tableName=(String)getRequest().getAttributes().get("tableName");
    final String segmentName=(String)getRequest().getAttributes().get("segmentName");
    if (resourceName != null && segmentName == null) {
      final JSONArray segmentsArray=new JSONArray();
      final JSONObject ret=new JSONObject();
      ret.put("resource",resourceName);
      if (tableName == null) {
        for (        final String segmentId : manager.getAllSegmentsForResource(resourceName)) {
          segmentsArray.put(segmentId);
        }
      }
 else {
        for (        final String segmentId : manager.getAllSegmentsForTable(resourceName,tableName)) {
          segmentsArray.put(segmentId);
        }
      }
      ret.put("segments",segmentsArray);
      presentation=new StringRepresentation(ret.toString());
    }
 else {
      final Map<String,String> segmentMetadata=manager.getMetadataFor(resourceName,segmentName);
      final JSONObject medata=new JSONObject();
      for (      final String key : segmentMetadata.keySet()) {
        medata.put(key,segmentMetadata.get(key));
      }
      final JSONObject ret=new JSONObject();
      ret.put("segmentName",segmentName);
      ret.put("metadata",medata);
      presentation=new StringRepresentation(ret.toString());
    }
  }
 catch (  final Exception e) {
    logger.error(e);
  }
  return presentation;
}
