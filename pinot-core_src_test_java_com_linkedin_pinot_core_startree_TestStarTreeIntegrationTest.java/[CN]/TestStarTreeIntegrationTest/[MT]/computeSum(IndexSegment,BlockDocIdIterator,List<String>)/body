{
  int docId;
  int numMetrics=metricNames.size();
  Dictionary[] dictionaries=new Dictionary[numMetrics];
  BlockSingleValIterator[] valIterators=new BlockSingleValIterator[numMetrics];
  for (int i=0; i < numMetrics; i++) {
    String metricName=metricNames.get(i);
    DataSource dataSource=segment.getDataSource(metricName);
    dictionaries[i]=dataSource.getDictionary();
    valIterators[i]=(BlockSingleValIterator)dataSource.getNextBlock().getBlockValueSet().iterator();
  }
  double[] sums=new double[numMetrics];
  while ((docId=docIdIterator.next()) != Constants.EOF) {
    for (int i=0; i < numMetrics; i++) {
      valIterators[i].skipTo(docId);
      int dictId=valIterators[i].nextIntVal();
      sums[i]+=dictionaries[i].getDoubleValue(dictId);
    }
  }
  return sums;
}
