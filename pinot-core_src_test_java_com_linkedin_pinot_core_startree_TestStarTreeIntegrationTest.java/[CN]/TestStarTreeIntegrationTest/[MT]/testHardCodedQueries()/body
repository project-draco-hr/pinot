{
  String[] queries=new String[]{"select sum(m1) from T","select sum(m1) from T where d1 = 'd1-v1'","select sum(m1) from T where d1 <> 'd1-v1'","select sum(m1) from T where d1 between 'd1-v1' and 'd1-v3'","select sum(m1) from T where d1 in ('d1-v1', 'd1-v2')","select sum(m1) from T where d1 in ('d1-v1', 'd1-v2') and d2 not in ('d2-v1')","select sum(m1) from T group by d1","select sum(m1) from T group by d1, d2","select sum(m1) from T where d1 = 'd1-v2' group by d1","select sum(m1) from T where d1 between 'd1-v1' and 'd1-v3' group by d2","select sum(m1) from T where d1 = 'd1-v2' group by d2, d3","select sum(m1) from T where d1 <> 'd1-v1' group by d2","select sum(m1) from T where d1 in ('d1-v1', 'd1-v2') group by d2","select sum(m1) from T where d1 in ('d1-v1', 'd1-v2') and d2 not in ('d2-v1') group by d3","select sum(m1) from T where d1 in ('d1-v1', 'd1-v2') and d2 not in ('d2-v1') group by d3, d4"};
  List<String> metricNames=_schema.getMetricNames();
  SegmentMetadata segmentMetadata=_segment.getSegmentMetadata();
  for (int i=0; i < queries.length; i++) {
    Pql2Compiler compiler=new Pql2Compiler();
    BrokerRequest brokerRequest=compiler.compileToBrokerRequest(queries[i]);
    FilterQueryTree filterQueryTree=RequestUtils.generateFilterQueryTree(brokerRequest);
    Assert.assertTrue(RequestUtils.isFitForStarTreeIndex(segmentMetadata,filterQueryTree,brokerRequest));
    Map<String,double[]> expectedResult=computeSumUsingRawDocs(metricNames,brokerRequest);
    Map<String,double[]> actualResult=computeSumUsingAggregatedDocs(metricNames,brokerRequest);
    Assert.assertEquals(expectedResult.size(),actualResult.size(),"Mis-match in number of groups");
    for (    Map.Entry<String,double[]> entry : expectedResult.entrySet()) {
      String expectedKey=entry.getKey();
      Assert.assertTrue(actualResult.containsKey(expectedKey));
      double[] expectedSums=entry.getValue();
      double[] actualSums=actualResult.get(expectedKey);
      for (int j=0; j < expectedSums.length; j++) {
        Assert.assertEquals(actualSums[j],expectedSums[j],"Mis-match sum for key '" + expectedKey + "', Metric: "+ metricNames.get(j)+ ", Random Seed: "+ _randomSeed);
      }
    }
  }
}
