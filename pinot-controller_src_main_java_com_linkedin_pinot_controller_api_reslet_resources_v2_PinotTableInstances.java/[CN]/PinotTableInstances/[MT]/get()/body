{
  final String tableName=(String)getRequest().getAttributes().get("tableName");
  final String type=getQueryValue("type");
  if (tableName == null) {
    return new StringRepresentation("tableName is not present");
  }
  JSONObject ret=new JSONObject();
  try {
    ret.put("tableName",tableName);
    JSONArray brokers=new JSONArray();
    JSONArray servers=new JSONArray();
    if (type == null || type.toLowerCase().equals("broker")) {
      if (manager.hasOfflineTable(tableName)) {
        JSONObject e=new JSONObject();
        e.put("tableType","offline");
        e.put("instances",new JSONObject(new ObjectMapper().writeValueAsString(manager.getBrokerInstancesForTable(tableName,TableType.OFFLINE))));
        brokers.add(e);
      }
      if (manager.hasRealtimeTable(tableName)) {
        JSONObject e=new JSONObject();
        e.put("tableType","offline");
        e.put("instances",new JSONObject(new ObjectMapper().writeValueAsString(manager.getBrokerInstancesForTable(tableName,TableType.REALTIME))));
        brokers.add(e);
      }
    }
    if (type == null || type.toLowerCase().equals("server")) {
      if (manager.hasOfflineTable(tableName)) {
        JSONObject e=new JSONObject();
        e.put("tableType","offline");
        e.put("instances",new JSONObject(new ObjectMapper().writeValueAsString(manager.getServerInstancesForTable(tableName,TableType.OFFLINE))));
        servers.add(e);
      }
      if (manager.hasRealtimeTable(tableName)) {
        JSONObject e=new JSONObject();
        e.put("tableType","offline");
        e.put("instances",new JSONObject(new ObjectMapper().writeValueAsString(manager.getServerInstancesForTable(tableName,TableType.REALTIME))));
        servers.add(e);
      }
    }
    ret.put("brokers",brokers);
    ret.put("server",servers);
    return new StringRepresentation(ret.toString());
  }
 catch (  Exception e) {
    LOGGER.error("error processing fetch table request, ",e);
    return PinotSegmentUploadRestletResource.exceptionToStringRepresentation(e);
  }
}
