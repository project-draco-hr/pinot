{
  String metricFunction=request.getMetricFunction();
  String collection=request.getCollection();
  DateTime startTime=request.getStartTime();
  DateTime endTime=request.getEndTime();
  if (metricFunction == null) {
    throw new IllegalStateException("Must provide metric function, e.g. `AGGREGATE_1_HOURS(m1)`");
  }
  if (collection == null) {
    throw new IllegalStateException("Must provide collection name");
  }
  if (startTime == null || endTime == null) {
    throw new IllegalStateException("Must provide start and end time");
  }
 else   if (startTime.isAfter(endTime)) {
    throw new IllegalStateException("Start time must come before end: " + startTime + ", "+ endTime);
  }
  return getSql(metricFunction,collection,startTime,endTime,request.getDimensionValues(),request.getGroupBy());
}
