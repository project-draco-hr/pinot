{
  byte[] responseByte;
  long serializationStartTime=System.nanoTime();
  try {
    if (instanceResponse == null) {
      LOGGER.warn("Instance response is null.");
      responseByte=new byte[0];
    }
 else {
      responseByte=instanceResponse.toBytes();
    }
  }
 catch (  Exception e) {
    _serverMetrics.addMeteredGlobalValue(ServerMeter.RESPONSE_SERIALIZATION_EXCEPTIONS,1);
    LOGGER.error("Got exception while serializing response.",e);
    responseByte=null;
  }
  long serializationEndTime=System.nanoTime();
  _serverMetrics.addPhaseTiming(brokerRequest,ServerQueryPhase.RESPONSE_SERIALIZATION,serializationEndTime - serializationStartTime);
  _serverMetrics.addPhaseTiming(brokerRequest,ServerQueryPhase.TOTAL_QUERY_TIME,serializationEndTime - queryStartTime);
  return responseByte;
}
