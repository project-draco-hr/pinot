{
  LOGGER.debug("processing request : " + request);
  DataTable instanceResponse=null;
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  byte[] byteArray=new byte[request.readableBytes()];
  request.readBytes(byteArray);
  SerDe serDe=new SerDe(new TCompactProtocol.Factory());
  InstanceRequest queryRequest=null;
  try {
    queryRequest=new InstanceRequest();
    serDe.deserialize(queryRequest,byteArray);
    LOGGER.info("instance request : " + queryRequest);
    instanceResponse=_queryExecutor.processQuery(queryRequest);
    LOGGER.debug("******************************");
    LOGGER.debug(instanceResponse.toString());
    LOGGER.debug("******************************");
  }
 catch (  Exception e) {
    LOGGER.error("Got exception while processing request. Returning error response",e);
    DataTableBuilder dataTableBuilder=new DataTableBuilder(null);
    List<ProcessingException> exceptions=new ArrayList<ProcessingException>();
    ProcessingException exception=QueryException.INTERNAL_ERROR.deepCopy();
    exception.setMessage(e.getMessage());
    exceptions.add(exception);
    instanceResponse=dataTableBuilder.buildExceptions();
  }
  try {
    if (instanceResponse == null) {
      return new byte[0];
    }
 else {
      return instanceResponse.toBytes();
    }
  }
 catch (  Exception e) {
    LOGGER.error("Got exception while serializing response.",e);
    return null;
  }
}
