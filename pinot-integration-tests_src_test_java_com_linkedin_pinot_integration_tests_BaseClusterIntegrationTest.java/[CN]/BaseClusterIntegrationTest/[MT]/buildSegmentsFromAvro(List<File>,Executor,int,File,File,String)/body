{
  int segmentCount=avroFiles.size();
  LOGGER.info("Building " + segmentCount + " segments in parallel");
  for (int i=1; i <= segmentCount; ++i) {
    final int segmentIndex=i - 1;
    final int segmentNumber=i + baseSegmentIndex;
    executor.execute(new Runnable(){
      @Override public void run(){
        try {
          LOGGER.info("Starting to build segment " + segmentNumber);
          File outputDir=new File(baseDirectory,"segment-" + segmentNumber);
          final SegmentGeneratorConfig genConfig=SegmentTestUtils.getSegmentGenSpecWithSchemAndProjectedColumns(avroFiles.get(segmentIndex),outputDir,TimeUnit.DAYS,tableName);
          genConfig.setSegmentNamePostfix(Integer.toString(segmentNumber));
          final SegmentIndexCreationDriver driver=SegmentCreationDriverFactory.get(null);
          driver.init(genConfig);
          driver.build();
          String segmentName=outputDir.list()[0];
          TarGzCompressionUtils.createTarGzOfDirectory(outputDir.getAbsolutePath() + "/" + segmentName,new File(segmentTarDir,segmentName).getAbsolutePath());
          LOGGER.info("Completed segment " + segmentNumber + " : "+ segmentName);
        }
 catch (        Exception e) {
          throw new RuntimeException(e);
        }
      }
    }
);
  }
}
