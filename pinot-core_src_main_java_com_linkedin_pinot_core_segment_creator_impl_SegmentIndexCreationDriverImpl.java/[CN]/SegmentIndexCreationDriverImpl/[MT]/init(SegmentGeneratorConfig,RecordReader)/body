{
  this.config=config;
  recordReader=reader;
  recordReader.init();
  dataSchema=recordReader.getSchema();
  statsCollector=new SegmentPreIndexStatsCollectorImpl(recordReader.getSchema());
  statsCollector.init();
  indexCreationInfoMap=new HashMap<String,ColumnIndexCreationInfo>();
  List<StarTreeIndexSpec> starTreeIndexSpecList=dataSchema.getStarTreeIndexSpecs();
  if (starTreeIndexSpecList == null || starTreeIndexSpecList.isEmpty()) {
    indexCreator=new SegmentColumnarIndexCreator();
  }
 else   if (starTreeIndexSpecList.size() != 1) {
    throw new IllegalStateException("Cannot build index with more than one star tree!");
  }
 else {
    indexCreator=new StarTreeSegmentCreator(starTreeIndexSpecList.get(0),recordReader);
    isStarTree=true;
  }
  final File indexDir=new File(config.getIndexOutputDir());
  if (!indexDir.exists()) {
    indexDir.mkdirs();
  }
  tempIndexDir=new File(indexDir,com.linkedin.pinot.common.utils.FileUtils.getRandomFileName());
}
