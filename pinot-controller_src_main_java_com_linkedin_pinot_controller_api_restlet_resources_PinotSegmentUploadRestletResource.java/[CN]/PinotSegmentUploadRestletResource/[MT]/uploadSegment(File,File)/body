{
  final SegmentMetadata metadata=new SegmentMetadataImpl(indexDir);
  final File tableDir=new File(baseDataDir,metadata.getTableName());
  File segmentFile=new File(tableDir,dataFile.getName());
  if (segmentFile.exists()) {
    FileUtils.deleteQuietly(segmentFile);
  }
  FileUtils.moveFile(dataFile,segmentFile);
  PinotResourceManagerResponse response;
  if (!isSegmentTimeValid(metadata)) {
    response=new PinotResourceManagerResponse("Invalid segment start/end time",false);
  }
 else {
    response=_pinotHelixResourceManager.addSegment(metadata,constructDownloadUrl(metadata.getTableName(),dataFile.getName()));
  }
  if (response.isSuccessfull()) {
    setStatus(Status.SUCCESS_OK);
  }
 else {
    ControllerRestApplication.metrics.addMeteredValue(null,ControllerMeter.CONTROLLER_INTERNAL_ERROR,1L);
    setStatus(Status.SERVER_ERROR_INTERNAL);
  }
  return new StringRepresentation(response.toJSON().toString());
}
