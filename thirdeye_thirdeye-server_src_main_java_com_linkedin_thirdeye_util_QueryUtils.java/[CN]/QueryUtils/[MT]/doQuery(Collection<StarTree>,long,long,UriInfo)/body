{
  Map<DimensionKey,MetricTimeSeries> result=new HashMap<DimensionKey,MetricTimeSeries>();
  for (  StarTree starTree : starTrees) {
    List<StarTreeQuery> queries=StarTreeUtils.expandQueries(starTree,UriUtils.createQueryBuilder(starTree,uriInfo).setTimeRange(new TimeRange(start,end)).build(starTree.getConfig()));
    queries=StarTreeUtils.filterQueries(starTree.getConfig(),queries,uriInfo.getQueryParameters());
    for (    StarTreeQuery query : queries) {
      MetricTimeSeries timeSeries=starTree.getTimeSeries(query);
      MetricTimeSeries existingTimeSeries=result.get(query.getDimensionKey());
      if (existingTimeSeries == null) {
        result.put(query.getDimensionKey(),timeSeries);
      }
 else {
        existingTimeSeries.aggregate(timeSeries);
      }
    }
  }
  return result;
}
