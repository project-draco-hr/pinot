{
  int anomalyResultsSize=anomalyResults.size();
  if (minConsecutiveSize > 1) {
    List<RawAnomalyResultDTO> anomalyResultsAggregated=new ArrayList<>();
    if (anomalyResultsSize >= minConsecutiveSize) {
      int remainingSize=anomalyResultsSize;
      List<RawAnomalyResultDTO> currentConsecutiveResults=new ArrayList<>();
      List<Double> consecutiveCurrentValues=new ArrayList<>();
      List<Double> consecutiveBaselineValues=new ArrayList<>();
      int n=-1;
      for (      RawAnomalyResultDTO anomalyResult : anomalyResults) {
        n++;
        if (currentConsecutiveResults.isEmpty()) {
          currentConsecutiveResults.add(anomalyResult);
          consecutiveCurrentValues.add(currentValues.get(n));
          consecutiveBaselineValues.add(baselineValues.get(n));
          remainingSize--;
        }
 else {
          RawAnomalyResultDTO lastConsecutiveAnomalyResult=currentConsecutiveResults.get(currentConsecutiveResults.size() - 1);
          long lastStartTime=lastConsecutiveAnomalyResult.getStartTime();
          long currentStarTime=anomalyResult.getStartTime();
          if ((lastStartTime + bucketMillis) == currentStarTime) {
            currentConsecutiveResults.add(anomalyResult);
            consecutiveCurrentValues.add(currentValues.get(n));
            consecutiveBaselineValues.add(baselineValues.get(n));
            remainingSize--;
            if (remainingSize == 0) {
              anomalyResultsAggregated.add(getMergedAnomalyResults(currentConsecutiveResults,consecutiveBaselineValues,consecutiveCurrentValues,threshold,baselineProp));
            }
          }
 else {
            if (currentConsecutiveResults.size() >= minConsecutiveSize) {
              anomalyResultsAggregated.add(getMergedAnomalyResults(currentConsecutiveResults,consecutiveBaselineValues,consecutiveCurrentValues,threshold,baselineProp));
            }
            if (remainingSize >= minConsecutiveSize) {
              currentConsecutiveResults.clear();
              consecutiveCurrentValues.clear();
              consecutiveBaselineValues.clear();
              currentConsecutiveResults.add(anomalyResult);
              consecutiveCurrentValues.add(currentValues.get(n));
              consecutiveBaselineValues.add(baselineValues.get(n));
              remainingSize--;
            }
 else {
              break;
            }
          }
        }
      }
    }
    return anomalyResultsAggregated;
  }
 else {
    return anomalyResults;
  }
}
