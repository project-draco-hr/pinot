{
  ExecutorService executorService=Executors.newFixedThreadPool(8);
  List<ResultTable> resultTables=Collections.synchronizedList(new ArrayList<ResultTable>());
  for (  final File segment : segmentsDir.listFiles()) {
    executorService.execute(new Runnable(){
      @Override public void run(){
        LOGGER.info("Processing segment: " + segment.getName());
        SegmentQueryProcessor processor=new SegmentQueryProcessor(brokerRequest,segment);
        try {
          ResultTable resultTable=processor.process(query);
          if (resultTable != null) {
            resultTables.add(resultTable);
          }
        }
 catch (        Exception e) {
          LOGGER.error("Exception caught while processing segment.",e);
          return;
        }
      }
    }
);
  }
  executorService.shutdown();
  executorService.awaitTermination(_timeoutInSeconds,TimeUnit.SECONDS);
  return resultTables;
}
