{
  this._helixPropertyStore=propertyStore;
  String segmentId=segmentZKMetadata.getSegmentName();
  if (segmentZKMetadata instanceof RealtimeSegmentZKMetadata) {
    if (new File(_indexDir,segmentId).exists()) {
      IndexSegment segment=ColumnarSegmentLoader.load(new File(_indexDir,segmentId),_readMode);
synchronized (getGlobalLock()) {
        _segmentsMap.put(segmentId,new OfflineSegmentDataManager(segment));
        markSegmentAsLoaded(segmentId);
        _referenceCounts.put(segmentId,new AtomicInteger(1));
      }
    }
 else {
      SegmentDataManager manager=new RealtimeSegmentDataManager((RealtimeSegmentZKMetadata)segmentZKMetadata,(RealtimeDataResourceZKMetadata)dataResourceZKMetadata,instanceZKMetadata,this,_indexDir.getAbsolutePath(),_readMode);
      _segmentsMap.put(segmentId,manager);
      _loadingSegments.add(segmentId);
      _referenceCounts.put(segmentId,new AtomicInteger(1));
    }
  }
}
