{
  for (  DimensionSpec dimensionSpec : config.getDimensions()) {
    Object dimensionValue=record.get(dimensionSpec.getName());
    if (dimensionValue == null) {
      throw new IllegalStateException("Record has no value for dimension " + dimensionSpec.getName());
    }
    builder.setDimensionValue(dimensionSpec.getName(),dimensionValue.toString());
  }
  for (int i=0; i < config.getMetrics().size(); i++) {
    String metricName=config.getMetrics().get(i).getName();
    Object metricValue=record.get(metricName);
    if (metricValue == null) {
      metricValue=0L;
    }
    builder.setMetricValue(metricName,((Number)metricValue).intValue());
    builder.setMetricType(metricName,config.getMetrics().get(i).getType());
  }
  Object time=record.get(config.getTime().getColumnName());
  if (time == null) {
    throw new IllegalStateException("Record does not have time column " + config.getTime().getColumnName() + ": "+ record);
  }
  builder.setTime(((Number)time).longValue());
}
