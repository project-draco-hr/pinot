{
  Map<String,String> dimensionValues=UriUtils.extractDimensionValues(uriInfo.getQueryParameters());
  CollectionSchema schema=dataCache.getCollectionSchema(serverUri,collection);
switch (metricViewType) {
case INTRA_DAY:
    String sql=SqlUtils.getSql(metricFunction,collection,new DateTime(baselineMillis - INTRA_DAY_PERIOD),new DateTime(currentMillis),dimensionValues);
  LOGGER.info("Generated SQL for {}: {}",uriInfo.getRequestUri(),sql);
QueryResult result=queryCache.getQueryResult(serverUri,sql);
return new MetricViewTabular(schema,objectMapper,result,currentMillis - baselineMillis,INTRA_DAY_PERIOD);
case TIME_SERIES_FULL:
case TIME_SERIES_OVERLAY:
case FUNNEL:
return new MetricViewTimeSeries(schema,dimensionValues);
default :
throw new NotFoundException("No metric view implementation for " + metricViewType);
}
}
