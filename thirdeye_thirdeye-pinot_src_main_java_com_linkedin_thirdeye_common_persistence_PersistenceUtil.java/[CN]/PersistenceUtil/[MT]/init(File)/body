{
  PersistenceConfig configuration=createConfiguration(localConfigFile);
  Properties properties=createDbPropertiesFromConfiguration(configuration);
  DataSource ds=new DataSource();
  ds.setUrl(configuration.getDatabaseConfiguration().getUrl());
  ds.setPassword(configuration.getDatabaseConfiguration().getPassword());
  ds.setUsername(configuration.getDatabaseConfiguration().getUser());
  ds.setDriverClassName(configuration.getDatabaseConfiguration().getProperties().get("hibernate.connection.driver_class"));
  ds.setMaxActive(100);
  ds.setMinIdle(10);
  ds.setInitialSize(10);
  ds.setValidationQuery("select 1 as dbcp_connection_test");
  ds.setTestWhileIdle(true);
  ds.setTestOnReturn(true);
  ds.setTestOnBorrow(true);
  ds.setRemoveAbandonedTimeout(15 * 60);
  ds.setRemoveAbandoned(true);
  properties.put(Environment.CONNECTION_PROVIDER,DatasourceConnectionProviderImpl.class.getName());
  properties.put(Environment.DATASOURCE,ds);
  JpaPersistModule jpaPersistModule=new JpaPersistModule(JPA_UNIT).properties(properties);
  injector=Guice.createInjector(jpaPersistModule,new PersistenceModule());
  injector.getInstance(PersistService.class).start();
}
