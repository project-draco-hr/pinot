{
  List<WorkListAnomalyDetectionTask> tasks=new LinkedList<>();
  AnomalyDetectionDriverConfig driverConfig=config.getDriverConfig();
  List<? extends FunctionTableRow> rows=FunctionTable.selectActiveRows(config.getAnomalyDatabaseConfig(),functionFactory.getFunctionRowClass(),config.getCollectionName());
  StarTreeConfig starTreeConfig=ThirdEyeServerUtils.getStarTreeConfig(config.getThirdEyeServerHost(),config.getThirdEyeServerPort(),config.getCollectionName());
  List<DimensionKeySeries> dimensionsToEvaluate=new AnomalyDetectionDriver(driverConfig,starTreeConfig,timeRange,thirdEyeClient).call();
  for (  FunctionTableRow functionTableRow : rows) {
    if (config.getFunctionIdToEvaluate() != null && config.getFunctionIdToEvaluate() != functionTableRow.getFunctionId()) {
      continue;
    }
    try {
      AnomalyDetectionFunction function=functionFactory.getFunction(starTreeConfig,config.getAnomalyDatabaseConfig(),functionTableRow);
      AnomalyDetectionTaskInfo taskInfo=new AnomalyDetectionTaskInfo(functionTableRow.getFunctionName(),functionTableRow.getFunctionId(),functionTableRow.getFunctionDescription(),timeRange);
      AnomalyResultHandler resultHandler=new AnomalyResultHandlerDatabase(config.getAnomalyDatabaseConfig());
      resultHandler.init(starTreeConfig,new HandlerProperties());
      AnomalyDetectionFunctionHistory functionHistory;
      if (config.isProvideAnomalyHistory()) {
        functionHistory=new AnomalyDetectionFunctionHistoryImpl(starTreeConfig,config.getAnomalyDatabaseConfig(),functionTableRow.getFunctionId());
      }
 else {
        functionHistory=AnomalyDetectionFunctionHistoryNoOp.sharedInstance();
      }
      WorkListAnomalyDetectionTask task=new WorkListAnomalyDetectionTask(starTreeConfig,taskInfo,function,resultHandler,functionHistory,thirdEyeClient,dimensionsToEvaluate);
      tasks.add(task);
    }
 catch (    Exception e) {
      LOGGER.error("could not create function for function_id={}",functionTableRow.getFunctionId(),e);
    }
  }
  return tasks;
}
