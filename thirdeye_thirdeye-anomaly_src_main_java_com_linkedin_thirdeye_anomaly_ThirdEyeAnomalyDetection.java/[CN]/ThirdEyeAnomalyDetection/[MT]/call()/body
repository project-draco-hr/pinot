{
  CachedThirdEyeClientConfig thirdEyeClientConfig=new CachedThirdEyeClientConfig();
  thirdEyeClientConfig.setExpirationTime(DEFAULT_CACHE_EXPIRATION_MINUTES);
  thirdEyeClientConfig.setExpirationUnit(TimeUnit.MINUTES);
  thirdEyeClientConfig.setExpireAfterAccess(false);
  thirdEyeClientConfig.setUseCacheForExecuteMethod(true);
  ThirdEyeClient thirdEyeClient=new DefaultThirdEyeClientFactory(thirdEyeClientConfig).getClient(config.getThirdEyeServerHost(),config.getThirdEyeServerPort());
  thirdEyeClient=new FlowControlledThirdEyeClient(thirdEyeClient,MAX_PARALLEL_REQUESTS);
  AnomalyDetectionFunctionFactory functionFactory;
switch (config.getMode()) {
case RULEBASED:
{
      functionFactory=new RuleBasedFunctionFactory();
      break;
    }
case GENERIC:
{
    functionFactory=new GenericFunctionFactory();
    break;
  }
default :
{
  functionFactory=null;
  break;
}
}
List<WorkListAnomalyDetectionTask> tasks=buildTasks(thirdEyeClient,timeRange,functionFactory);
ExecutorService taskExecutors=Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());
for (WorkListAnomalyDetectionTask task : tasks) {
taskExecutors.execute(task);
}
taskExecutors.shutdown();
taskExecutors.awaitTermination(config.getMaxWaitToCompletion().getSize(),config.getMaxWaitToCompletion().getUnit());
thirdEyeClient.close();
return null;
}
