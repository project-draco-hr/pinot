{
  long detectionIntervalInMillis=TimeGranularityUtils.toMillis(config.getDetectionInterval());
  long latestTimeDataAvailable=ServerUtils.getLatestTime(config.getThirdEyeServerHost(),config.getThirdEyeServerPort(),config.getCollectionName());
  long prevTime=TimeGranularityUtils.truncateBy(latestTimeDataAvailable,config.getDetectionInterval());
  while (true) {
    latestTimeDataAvailable=ServerUtils.getLatestTime(config.getThirdEyeServerHost(),config.getThirdEyeServerPort(),config.getCollectionName());
    long nextTime=prevTime;
    while (nextTime + detectionIntervalInMillis <= latestTimeDataAvailable) {
      nextTime+=detectionIntervalInMillis;
    }
    if (nextTime != prevTime) {
      ;
      LOGGER.info("begin processing for {} to {}",prevTime,nextTime);
      final TimeRange taskTimeRange=new TimeRange(prevTime,nextTime);
      new Thread(new Runnable(){
        @Override public void run(){
          try {
            new ThirdEyeAnomalyDetection(config,taskTimeRange).call();
          }
 catch (          Exception e) {
            LOGGER.error("uncaught exception",e);
          }
        }
      }
).start();
      prevTime=nextTime;
    }
 else {
      LOGGER.info("no new data available, polling again at {} for {}",DateTime.now().plusMillis((int)MILLIS_BEWEEEN_POLLS),new DateTime(prevTime + detectionIntervalInMillis));
    }
    Thread.sleep(MILLIS_BEWEEEN_POLLS);
  }
}
