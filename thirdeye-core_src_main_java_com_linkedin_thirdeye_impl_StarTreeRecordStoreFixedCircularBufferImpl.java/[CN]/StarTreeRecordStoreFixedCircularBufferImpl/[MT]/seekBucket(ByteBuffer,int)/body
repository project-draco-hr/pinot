{
  buffer.clear();
  if (targetBucket > 0) {
    int previousBucket=targetBucket - 1;
    int startIdx=-1;
    while (buffer.position() < buffer.limit()) {
      int idx=((buffer.limit() + buffer.position()) / entrySize / 2) * entrySize;
      buffer.mark();
      buffer.position(idx);
      int currentBucket=buffer.getInt();
      buffer.reset();
      if (previousBucket == currentBucket) {
        startIdx=idx;
        break;
      }
 else       if (previousBucket < currentBucket) {
        buffer.limit(idx);
      }
 else {
        buffer.position(idx + entrySize);
      }
    }
    if (buffer.position() == buffer.limit()) {
      throw new IllegalStateException("Could not find target bucket " + targetBucket);
    }
    buffer.clear();
    buffer.position(startIdx);
    int currentBucket=previousBucket;
    while (buffer.position() < buffer.limit()) {
      buffer.mark();
      currentBucket=buffer.getInt();
      if (currentBucket == targetBucket) {
        break;
      }
      for (      String dimensionName : dimensionNames) {
        buffer.getInt();
      }
      buffer.getLong();
      for (      String metricName : metricNames) {
        buffer.getLong();
      }
    }
    buffer.reset();
  }
  return buffer.position();
}
