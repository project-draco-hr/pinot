{
  StringBuilder sb=new StringBuilder();
  sb.append("SELECT * FROM ").append(dbconfig.getAnomalyTableName()).append(" WHERE ");
  List<String> whereClause=new LinkedList<>();
  if (dbconfig.getFunctionTableName() != null) {
    whereClause.add("function_table = '" + dbconfig.getFunctionTableName() + "'");
  }
  if (functionId != null) {
    whereClause.add("function_id = '" + functionId + "'");
  }
  if (collection != null) {
    whereClause.add("collection = '" + collection + "'");
  }
  if (functionName != null) {
    whereClause.add("function_name = '" + functionName + "'");
  }
  if (functionDescription != null) {
    whereClause.add("function_description LIKE '" + functionDescription + "'");
  }
  if (topLevelOnly) {
    whereClause.add("non_star_count = 0");
  }
  if (timeRange != null) {
    whereClause.add("time_window BETWEEN '" + DATE_FORMAT.format(timeRange.getStart()) + "' AND '"+ DATE_FORMAT.format(timeRange.getEnd())+ "'");
  }
  sb.append(AND.join(whereClause));
  if (orderBy != null && orderBy.size() > 0) {
    sb.append(" ORDER BY ").append(COMMA.join(orderBy));
  }
  sb.append(";");
  return sb.toString();
}
