{
  StringBuilder sb=new StringBuilder();
  sb.append("SELECT * FROM ").append(dbconfig.getAnomalyTableName()).append(" WHERE");
  if (collection != null) {
    sb.append(" collection = '" + collection + "' AND");
  }
  if (ruleName != null) {
    sb.append(" function_name = '" + ruleName + "' AND");
  }
  if (ruleDescription != null) {
    sb.append(" function_description LIKE '" + ruleDescription + "' AND");
  }
  if (topLevelOnly) {
    sb.append(" non_star_count = 0 AND");
  }
  SimpleDateFormat sdf=new SimpleDateFormat(dbconfig.getDateFormat());
  sdf.setTimeZone(TimeZone.getTimeZone("UTC"));
  sb.append(" time_window BETWEEN '" + sdf.format(startTimeWindow) + "' AND '"+ sdf.format(endTimeWidnow)+ "'");
  if (orderBy != null && orderBy.size() > 0) {
    sb.append(" ORDER BY ").append(COMMA.join(orderBy));
  }
  sb.append(";");
  return sb.toString();
}
