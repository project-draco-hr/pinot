{
  LOG.info("Running " + jobExecutionContext.getJobDetail().getKey().toString());
  detectionJobContext=(DetectionJobContext)jobExecutionContext.getJobDetail().getJobDataMap().get(DETECTION_JOB_CONTEXT);
  anomalyJobSpecDAO=detectionJobContext.getAnomalyJobDAO();
  anomalyTasksSpecDAO=detectionJobContext.getAnomalyTaskDAO();
  anomalyFunctionSpecDAO=detectionJobContext.getAnomalyFunctionDAO();
  anomalyFunctionId=detectionJobContext.getAnomalyFunctionId();
  AnomalyFunctionSpec anomalyFunctionSpec=getAnomalyFunctionSpec(anomalyFunctionId);
  detectionJobContext.setAnomalyFunctionSpec(anomalyFunctionSpec);
  String windowEndProp=detectionJobContext.getWindowEndIso();
  String windowStartProp=detectionJobContext.getWindowStartIso();
  if (windowEndProp == null) {
    long delayMillis=0;
    if (anomalyFunctionSpec.getWindowDelay() != null) {
      delayMillis=TimeUnit.MILLISECONDS.convert(anomalyFunctionSpec.getWindowDelay(),anomalyFunctionSpec.getWindowDelayUnit());
    }
    Date scheduledFireTime=jobExecutionContext.getScheduledFireTime();
    windowEnd=new DateTime(scheduledFireTime).minus(delayMillis);
  }
 else {
    windowEnd=ISODateTimeFormat.dateTimeParser().parseDateTime(windowEndProp);
  }
  if (windowStartProp == null) {
    int windowSize=anomalyFunctionSpec.getWindowSize();
    TimeUnit windowUnit=anomalyFunctionSpec.getWindowUnit();
    long windowMillis=TimeUnit.MILLISECONDS.convert(windowSize,windowUnit);
    windowStart=windowEnd.minus(windowMillis);
  }
 else {
    windowStart=ISODateTimeFormat.dateTimeParser().parseDateTime(windowStartProp);
  }
  detectionJobContext.setWindowStart(windowStart);
  detectionJobContext.setWindowEnd(windowEnd);
  Long jobExecutionId=createJob();
  detectionJobContext.setJobExecutionId(jobExecutionId);
  List<Long> taskIds=createTasks();
}
