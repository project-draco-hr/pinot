{
  String functionName=function.getName();
  int capacityCap=maxNumResults > Integer.MAX_VALUE ? Integer.MAX_VALUE : (int)maxNumResults;
  int initialCapacity=Math.min(capacityCap,INITIAL_RESULT_HOLDER_CAPACITY);
switch (functionName.toLowerCase()) {
case "count":
case "sum":
case "min":
case "max":
    double defaultValue=function.getDefaultValue();
  DoubleResultArray doubleResultArray=new DoubleResultArray(initialCapacity,defaultValue);
return new DoubleArrayBasedResultHolder(doubleResultArray,initialCapacity,capacityCap);
case "avg":
DoubleLongResultArray doubleLongResultArray=new DoubleLongResultArray(initialCapacity,new Pair<>(0.0,0L));
return new PairArrayBasedResultHolder(doubleLongResultArray,initialCapacity,capacityCap);
case "minmaxrange":
DoubleDoubleResultArray doubleDoubleResultArray=new DoubleDoubleResultArray(initialCapacity,new Pair<>(Double.POSITIVE_INFINITY,Double.NEGATIVE_INFINITY));
return new PairArrayBasedResultHolder(doubleDoubleResultArray,initialCapacity,capacityCap);
default :
throw new RuntimeException("Aggregation function not implemented in ResultHolder: " + functionName);
}
}
