{
  EmailConfiguration emailSpec=getEmailConfiguration();
  emailConfigurationDAO.save(emailSpec);
  List<AnomalyFunctionSpec> functionSpecList=new ArrayList<>();
  functionSpecList.add(spec);
  emailSpec.setFunctions(functionSpecList);
  emailConfigurationDAO.save(emailSpec);
  List<AnomalyResult> results=anomalyResultDAO.findValidAllByTimeAndEmailId(new DateTime().minusHours(1),new DateTime(),emailSpec.getId());
  Assert.assertEquals(results.size(),1);
  Assert.assertEquals(results.get(0).isDataMissing(),false);
  Assert.assertEquals(emailSpec.getFunctions().get(0).getId(),results.get(0).getFunction().getId());
  emailConfigurationDAO.delete(emailSpec);
}
