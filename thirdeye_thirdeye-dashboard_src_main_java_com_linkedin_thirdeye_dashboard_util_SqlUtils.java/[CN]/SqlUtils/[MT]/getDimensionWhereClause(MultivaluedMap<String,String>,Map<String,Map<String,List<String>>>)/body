{
  List<String> components=new ArrayList<>();
  for (  Map.Entry<String,List<String>> entry : dimensionValues.entrySet()) {
    if (entry.getValue().size() == 1 && "!".equals(entry.getValue().get(0))) {
      continue;
    }
    List<String> values=entry.getValue();
    if (dimensionGroups != null) {
      values=new ArrayList<>();
      Map<String,List<String>> groups=dimensionGroups.get(entry.getKey());
      for (      String value : entry.getValue()) {
        if (groups != null && groups.containsKey(value)) {
          values.addAll(groups.get(value));
        }
 else {
          values.add(value);
        }
      }
    }
    List<String> equals=new ArrayList<>(entry.getValue().size());
    for (    String value : values) {
      equals.add(EQUALS.join(entry.getKey(),String.format("'%s'",value)));
    }
    components.add(OR.join(equals));
  }
  if (components.isEmpty()) {
    return null;
  }
  return AND.join(components);
}
