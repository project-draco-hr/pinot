{
  final String resourceName=instanceRequest.getQuery().getQuerySource().getResourceName();
  final ResourceDataManager resourceDataManager=_instanceDataManager.getResourceDataManager(resourceName);
  if (resourceDataManager == null || instanceRequest.getSearchSegmentsSize() == 0) {
    return new ArrayList<IndexSegment>();
  }
  final List<IndexSegment> queryableSegmentDataManagerList=new ArrayList<IndexSegment>();
  final List<OfflineSegmentDataManager> matchedSegmentDataManagerFromServer=resourceDataManager.getSegments(instanceRequest.getSearchSegments());
  LOGGER.info("InstanceRequest request " + instanceRequest.getSearchSegments().size() + " segments : "+ Arrays.toString(instanceRequest.getSearchSegments().toArray(new String[0])));
  LOGGER.info("ResourceDataManager found " + matchedSegmentDataManagerFromServer.size() + " segments before pruning : "+ Arrays.toString(matchedSegmentDataManagerFromServer.toArray(new OfflineSegmentDataManager[0])));
  for (  final OfflineSegmentDataManager segmentDataManager : matchedSegmentDataManagerFromServer) {
    final IndexSegment indexSegment=segmentDataManager.getSegment();
    if (!_segmentPrunerService.prune(indexSegment,instanceRequest.getQuery())) {
      queryableSegmentDataManagerList.add(indexSegment);
    }
  }
  return queryableSegmentDataManagerList;
}
