{
  String resourceName=instanceRequest.getQuery().getQuerySource().getResourceName();
  ResourceDataManager resourceDataManager=_instanceDataManager.getResourceDataManager(resourceName);
  if (resourceDataManager == null) {
    return new ArrayList<IndexSegment>();
  }
  List<SegmentDataManager> queryableSegmentDataManagers;
  if (instanceRequest.getSearchSegmentsSize() > 0) {
    queryableSegmentDataManagers=resourceDataManager.getSegments(instanceRequest.getSearchSegments());
  }
 else {
    return new ArrayList<IndexSegment>();
  }
  List<IndexSegment> queryableSegmentDataManagerList=new ArrayList<IndexSegment>();
  for (  SegmentDataManager segmentDataManager : queryableSegmentDataManagers) {
    IndexSegment indexSegment=segmentDataManager.getSegment();
    if (!_segmentPrunerService.prune(indexSegment,instanceRequest.getQuery())) {
      queryableSegmentDataManagerList.add(indexSegment);
    }
  }
  return queryableSegmentDataManagerList;
}
