{
  StarTree starTree=manager.getStarTree(collection);
  if (starTree == null) {
    throw new NotFoundException("No collection " + collection);
  }
  Map<DimensionKey,MetricTimeSeries> result=QueryUtils.doQuery(starTree,start,end,uriInfo);
  for (  Map.Entry<DimensionKey,MetricTimeSeries> entry : result.entrySet()) {
    MetricTimeSeries normalized=normalizingMetricName == null ? MetricTimeSeriesUtils.normalize(entry.getValue()) : MetricTimeSeriesUtils.normalize(entry.getValue(),normalizingMetricName);
    result.put(entry.getKey(),normalized);
  }
  return convert(starTree.getConfig(),Arrays.asList(metrics.split(",")),timeWindow,result);
}
