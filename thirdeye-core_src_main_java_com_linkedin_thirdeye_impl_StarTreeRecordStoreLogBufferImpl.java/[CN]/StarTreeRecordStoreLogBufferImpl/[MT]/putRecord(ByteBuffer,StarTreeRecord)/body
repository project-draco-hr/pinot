{
  for (  String dimensionName : dimensionNames) {
    String dimensionValue=record.getDimensionValues().get(dimensionName);
    if (StarTreeConstants.STAR.equals(dimensionValue)) {
      buffer.putInt(STAR_VALUE);
    }
 else {
      Map<String,Integer> valueIds=getForwardIndex().get(dimensionName);
      if (valueIds == null) {
        valueIds=new HashMap<String,Integer>();
        getForwardIndex().put(dimensionName,valueIds);
      }
      Integer valueId=valueIds.get(dimensionValue);
      if (valueId == null) {
        valueId=nextValueId.getAndIncrement();
        valueIds.put(dimensionValue,valueId);
        reverseIndex.get(dimensionName).put(valueId,dimensionValue);
      }
      buffer.putInt(valueId);
    }
  }
  buffer.putLong(record.getTime() == null ? -1L : record.getTime());
  for (int i=0; i < metricNames.size(); i++) {
    String metricName=metricNames.get(i);
    Number value=record.getMetricValues().get(metricName);
    if (value == null) {
      System.out.println("here");
    }
    NumberUtils.addToBuffer(buffer,value,metricTypes.get(i));
  }
}
