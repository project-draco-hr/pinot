{
  for (  DimensionSpec dimensionSpec : dimensionSpecs) {
    String dimensionValue=record.getDimensionValues().get(dimensionSpec.getName());
    if (StarTreeConstants.STAR.equals(dimensionValue)) {
      buffer.putInt(STAR_VALUE);
    }
 else {
      Map<String,Integer> valueIds=getForwardIndex().get(dimensionSpec.getName());
      if (valueIds == null) {
        valueIds=new HashMap<String,Integer>();
        getForwardIndex().put(dimensionSpec.getName(),valueIds);
      }
      Integer valueId=valueIds.get(dimensionValue);
      if (valueId == null) {
        valueId=nextValueId.getAndIncrement();
        valueIds.put(dimensionValue,valueId);
        reverseIndex.get(dimensionSpec.getName()).put(valueId,dimensionValue);
      }
      buffer.putInt(valueId);
    }
  }
  buffer.putLong(record.getTime() == null ? -1L : record.getTime());
  for (int i=0; i < metricSpecs.size(); i++) {
    String metricName=metricSpecs.get(i).getName();
    Number value=record.getMetricValues().get(metricName);
    NumberUtils.addToBuffer(buffer,value,metricSpecs.get(i).getType());
  }
}
