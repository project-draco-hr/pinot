{
  LOGGER.info("Trying to mark instance to dropped state");
  IdealState brokerIdealState=helixAdmin.getResourceIdealState(helixClusterName,CommonConstants.Helix.BROKER_RESOURCE_INSTANCE);
  if (brokerIdealState.getPartitionSet().contains(resourceTag)) {
    Map<String,String> instanceStateMap=brokerIdealState.getInstanceStateMap(resourceTag);
    for (    String instance : instanceStateMap.keySet()) {
      brokerIdealState.setPartitionState(resourceTag,instance,"DROPPED");
    }
    helixAdmin.setResourceIdealState(helixClusterName,CommonConstants.Helix.BROKER_RESOURCE_INSTANCE,brokerIdealState);
  }
  LOGGER.info("Trying to remove resource from idealstats");
  if (brokerIdealState.getPartitionSet().contains(resourceTag)) {
    brokerIdealState.getPartitionSet().remove(resourceTag);
    helixAdmin.setResourceIdealState(helixClusterName,CommonConstants.Helix.BROKER_RESOURCE_INSTANCE,brokerIdealState);
  }
}
