{
  if (seasonality != 168) {
    throw new IllegalArgumentException("only 168 seasonality is supported");
  }
  int numDataPoints=timestamps.length;
  if (numDataPoints != series.length) {
    throw new IllegalArgumentException("time series lengths do not match");
  }
  if (seasonality < 0) {
    throw new IllegalArgumentException("seasonality cannot be negative");
  }
  double[] result=new double[numDataPoints];
  Process process=null;
  BufferedReader stdout=null;
  BufferedWriter stdin=null;
  try {
    ProcessBuilder processBuilder=new ProcessBuilder("Rscript",STLDecompositionUtils.class.getClassLoader().getResource("r/stl-wrapper.R").getPath());
    processBuilder.redirectErrorStream(true);
    process=processBuilder.start();
    stdout=new BufferedReader(new InputStreamReader(process.getInputStream()));
    stdin=new BufferedWriter(new OutputStreamWriter(process.getOutputStream()));
    stdin.write("\"Bucket\",\"Median\"\n");
    for (int i=0; i < numDataPoints; i++) {
      stdin.write(DATE_FORMAT.format(new Date(timestamps[i])) + "," + series[i]+ "\n");
    }
    stdin.close();
    process.waitFor();
    String headers=stdout.readLine();
    for (int i=0; i < numDataPoints; i++) {
      String line=stdout.readLine();
      result[i]=Double.valueOf(line.split(",")[1]);
    }
  }
 catch (  Exception e) {
    LOGGER.info("exception trying to run stl",e);
    return null;
  }
 finally {
    if (process != null) {
      process.destroyForcibly();
    }
    if (stdin != null) {
      try {
        stdin.close();
      }
 catch (      IOException e1) {
        e1.printStackTrace();
      }
    }
    if (stdout != null) {
      try {
        stdout.close();
      }
 catch (      IOException e1) {
        e1.printStackTrace();
      }
    }
  }
  return result;
}
