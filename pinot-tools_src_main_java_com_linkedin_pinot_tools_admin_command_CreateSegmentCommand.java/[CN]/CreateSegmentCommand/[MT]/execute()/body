{
  File dir=new File(_dataDir);
  if (!dir.exists() || !dir.isDirectory()) {
    throw new RuntimeException("Data directory " + _dataDir + " not found.");
  }
  File[] files=dir.listFiles(new FilenameFilter(){
    @Override public boolean accept(    File dir,    String name){
      return name.endsWith("avro");
    }
  }
);
  if ((files == null) || (files.length == 0)) {
    throw new RuntimeException("Data directory " + _dataDir + " does not contain AVRO files.");
  }
  File odir=new File(_outDir);
  if (odir.exists()) {
    if (!_overwrite) {
      throw new IOException("Error: Output directory already exists.");
    }
 else {
      FileUtils.deleteDirectory(odir);
    }
  }
  Schema schema;
  if (_schemaFile != null) {
    File schemaFile=new File(_schemaFile);
    schema=new ObjectMapper().readValue(schemaFile,Schema.class);
  }
 else {
    schema=AvroUtils.extractSchemaFromAvro(files[0]);
  }
  final SegmentGeneratorConfig config=new SegmentGeneratorConfig(schema);
  config.setInputFileFormat(FileFormat.AVRO);
  config.setSegmentVersion(SegmentVersion.v1);
  config.setIndexOutputDir(_outDir);
  config.setSegmentName(_segmentName);
  config.setResourceName(_resourceName);
  config.setTableName(_tableName);
  config.setTimeColumnName(schema.getTimeColumnName());
  config.setTimeUnitForSegment(schema.getTimeSpec().getIncomingGranularitySpec().getTimeType());
  int cnt=0;
  for (  File file : files) {
    final SegmentIndexCreationDriverImpl driver=new SegmentIndexCreationDriverImpl();
    config.setInputFilePath(file.getAbsolutePath());
    config.setSegmentName(_segmentName + cnt);
    driver.init(config);
    driver.build();
    cnt=cnt + 1;
  }
  return true;
}
