{
  ExecutorService executorService=environment.lifecycle().executorService("starTreeManager").minThreads(Runtime.getRuntime().availableProcessors()).maxThreads(Runtime.getRuntime().availableProcessors()).build();
  StarTreeManager starTreeManager=new StarTreeManagerImpl(executorService);
  HelixManager helixManager=null;
  if (config.isDistributed()) {
    helixManager=HelixManagerFactory.getZKHelixManager(config.getClusterName(),config.getInstanceName(),InstanceType.PARTICIPANT,config.getZkAddress());
    helixManager.getStateMachineEngine().registerStateModelFactory(StateModelDefId.OnlineOffline,new ThirdEyeTransitionHandlerFactory(starTreeManager));
  }
  environment.jersey().register(new ThirdEyeMetricsResource(starTreeManager));
  environment.jersey().register(new ThirdEyeDimensionsResource(starTreeManager));
  environment.jersey().register(new ThirdEyeCollectionsResource(starTreeManager));
  environment.jersey().register(new ThirdEyeTimeSeriesResource(starTreeManager));
  environment.healthChecks().register(NAME,new ThirdEyeHealthCheck());
  environment.admin().addTask(new ThirdEyeRestoreTask(starTreeManager,new File(config.getRootDir())));
  environment.admin().addTask(new ThirdEyeCreateTask(starTreeManager));
  environment.admin().addTask(new ThirdEyeDumpTreeTask(starTreeManager));
  environment.admin().addTask(new ThirdEyeDumpBufferTask(starTreeManager));
  environment.admin().addTask(new ThirdEyeBulkLoadTask(executorService,starTreeManager,new File(config.getRootDir()),new File(config.getTmpDir())));
  environment.admin().addTask(new ThirdEyeBootstrapTask(new File(config.getRootDir())));
  environment.lifecycle().addLifeCycleListener(new ThirdEyeLifeCycleListener(helixManager,starTreeManager));
}
