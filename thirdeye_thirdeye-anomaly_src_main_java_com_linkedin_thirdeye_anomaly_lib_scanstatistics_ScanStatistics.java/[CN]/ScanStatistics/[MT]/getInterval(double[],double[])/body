{
  OnlineNormalStatistics trainDataDs=new OnlineNormalStatistics(trainingData);
  NormalDistribution trainDataNormal=new NormalDistribution(trainDataDs.getMean(),Math.sqrt(trainDataDs.getPopulationVariance()));
  ScanIntervalIterator scanWindowIterator=new ScanIntervalIterator(0,monitoringData.length,_minWindowLength,_maxWindowLength,_minIncrement);
  MaxInterval realDataInterval=generateMaxLikelihood(scanWindowIterator,trainingData,monitoringData,trainDataDs);
  if (realDataInterval.getInterval() == null) {
    throw new FunctionDidNotEvaluateException("no interval generated");
  }
  int numExceeded=0;
  int exceededCountThreshold=(int)(_pValue * _numSimulation);
  double[] simulationBuffer=new double[monitoringData.length];
  for (int ii=0; ii < _numSimulation; ii++) {
    LOGGER.info("started simulation {}",ii);
    if (_bootstrap) {
      simulateBootstrapInPlace(simulationBuffer,trainingData);
    }
 else {
      simulateGaussuanInPlace(simulationBuffer,trainDataNormal);
    }
    ScanIntervalIterator simulationScanWindowIterator=new ScanIntervalIterator(0,monitoringData.length,_minWindowLength,_maxWindowLength,_minIncrement);
    MaxInterval simulationResult=generateMaxLikelihood(simulationScanWindowIterator,trainingData,simulationBuffer,trainDataDs);
    LOGGER.info("finished simulation {} : {}",ii,simulationResult.getMaxLikelihood());
    if (simulationResult.getInterval() != null && realDataInterval.getMaxLikelihood() < simulationResult.getMaxLikelihood()) {
      numExceeded++;
      if (numExceeded >= exceededCountThreshold) {
        break;
      }
    }
  }
  LOGGER.info("real one: {} (percentile {})",realDataInterval.getMaxLikelihood(),1 - (numExceeded / (double)_numSimulation));
  if (numExceeded < exceededCountThreshold) {
    return realDataInterval.getInterval();
  }
 else {
    return null;
  }
}
