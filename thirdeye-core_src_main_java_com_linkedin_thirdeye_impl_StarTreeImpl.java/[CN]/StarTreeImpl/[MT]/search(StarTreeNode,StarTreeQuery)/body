{
  if (node.isLeaf()) {
    long[] sums=node.getRecordStore().getMetricSums(query,thresholdFunction);
    StarTreeRecordImpl.Builder result=new StarTreeRecordImpl.Builder();
    result.setDimensionValues(query.getDimensionValues());
    int idx=0;
    for (    String metricName : config.getMetricNames()) {
      result.setMetricValue(metricName,sums[idx++]);
    }
    return result.build();
  }
 else {
    StarTreeNode target=null;
    String queryDimensionValue=query.getDimensionValues().get(node.getChildDimensionName());
    if (StarTreeConstants.STAR.equals(queryDimensionValue)) {
      target=node.getStarNode();
    }
 else     if (StarTreeConstants.OTHER.equals(queryDimensionValue)) {
      target=node.getOtherNode();
    }
 else {
      target=node.getChild(queryDimensionValue);
    }
    if (target == null) {
      target=node.getOtherNode();
    }
    return search(target,query);
  }
}
