{
  int numInstancesPerReplica=realtimeDataResource.getNumDataInstances() / realtimeDataResource.getNumDataReplicas();
  int partitionId=0;
  int replicaId=0;
  String groupId=realtimeDataResource.getStreamProviderConfig().get(StringUtil.join(".",Helix.DataSource.STREAM,Helix.DataSource.Realtime.Kafka.HighLevelConsumer.GROUP_ID));
  for (  String instance : instanceList) {
    InstanceZKMetadata instanceZKMetadata=ZKMetadataProvider.getInstanceZKMetadata(zkHelixPropertyStore,instance);
    if (instanceZKMetadata == null) {
      instanceZKMetadata=new InstanceZKMetadata();
      String[] instanceConfigs=instance.split("_");
      assert(instanceConfigs.length == 3);
      instanceZKMetadata.setInstanceType(instanceConfigs[0]);
      instanceZKMetadata.setInstanceName(instanceConfigs[1]);
      instanceZKMetadata.setInstancePort(Integer.parseInt(instanceConfigs[2]));
    }
    instanceZKMetadata.setGroupId(realtimeResourceName,groupId + "_" + replicaId);
    instanceZKMetadata.setPartition(realtimeResourceName,Integer.toString(partitionId));
    partitionId=(partitionId + 1) % numInstancesPerReplica;
    if (partitionId == 0) {
      replicaId++;
    }
    ZKMetadataProvider.setInstanceZKMetadata(zkHelixPropertyStore,instanceZKMetadata);
  }
}
