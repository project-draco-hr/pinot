{
  buffer.clear();
  int[] lastDimensions=null;
  int[] currentDimensions=new int[dimensionNames.size()];
  while (buffer.position() < buffer.limit()) {
    for (int i=0; i < dimensionNames.size(); i++) {
      currentDimensions[i]=buffer.getInt();
      Map<Integer,String> reverse=reverseIndex.get(dimensionNames.get(i));
      String dimensionValue=reverse.get(currentDimensions[i]);
      if (dimensionValue == null) {
        throw new IllegalArgumentException("No dimension value in index for ID " + currentDimensions[i]);
      }
      Set<String> values=dimensionValues.get(dimensionNames.get(i));
      if (values == null) {
        values=new HashSet<String>();
        dimensionValues.put(dimensionNames.get(i),values);
      }
      values.add(dimensionValue);
    }
    if (lastDimensions != null && COMPARATOR.compare(lastDimensions,currentDimensions) >= 0) {
      throw new IllegalStateException("Buffer dimension values are not unique and sorted: " + Arrays.toString(lastDimensions) + "; "+ Arrays.toString(currentDimensions));
    }
    for (int i=0; i < numTimeBuckets; i++) {
      long time=buffer.getLong();
      if (time < minTime.get()) {
        minTime.set(time);
      }
      if (time > maxTime.get()) {
        maxTime.set(time);
      }
      if (time % numTimeBuckets != i) {
        throw new IllegalStateException("Time bucket violation: " + time + " % "+ numTimeBuckets+ " != "+ i);
      }
      for (      String metricName : metricNames) {
        buffer.getInt();
      }
    }
    if (lastDimensions == null) {
      lastDimensions=new int[dimensionNames.size()];
    }
    System.arraycopy(currentDimensions,0,lastDimensions,0,currentDimensions.length);
    recordCount++;
  }
}
