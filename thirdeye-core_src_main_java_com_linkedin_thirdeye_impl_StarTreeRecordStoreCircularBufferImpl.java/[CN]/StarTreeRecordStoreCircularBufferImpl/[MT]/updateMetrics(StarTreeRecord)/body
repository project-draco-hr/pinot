{
  buffer.mark();
  Number[] metrics=new Number[metricNames.size()];
  long time=getMetrics(metrics);
  buffer.reset();
  buffer.putLong(record.getTime());
  for (int i=0; i < metricNames.size(); i++) {
    String name=metricNames.get(i);
    String type=metricTypes.get(i);
    Number metricValue=record.getMetricValues().get(name);
    if (time == record.getTime()) {
      Number sum=NumberUtils.sum(metrics[i],metricValue,type);
      NumberUtils.addToBuffer(buffer,sum,type);
    }
 else {
      NumberUtils.addToBuffer(buffer,metricValue,type);
    }
  }
}
