{
  buffer.mark();
  Number[] metrics=new Number[metricSpecs.size()];
  long time=getMetrics(metrics);
  buffer.reset();
  buffer.putLong(record.getTime());
  for (int i=0; i < metricSpecs.size(); i++) {
    String name=metricSpecs.get(i).getName();
    MetricType type=metricSpecs.get(i).getType();
    Number metricValue=record.getMetricValues().get(name);
    if (time == record.getTime()) {
      Number sum=NumberUtils.sum(metrics[i],metricValue,type);
      NumberUtils.addToBuffer(buffer,sum,type);
    }
 else {
      NumberUtils.addToBuffer(buffer,metricValue,type);
    }
  }
}
