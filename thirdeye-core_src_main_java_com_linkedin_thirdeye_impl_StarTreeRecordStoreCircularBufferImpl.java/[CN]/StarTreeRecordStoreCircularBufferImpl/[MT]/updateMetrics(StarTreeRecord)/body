{
  buffer.mark();
  int[] metrics=new int[metricNames.size()];
  long time=getMetrics(metrics);
  buffer.reset();
  buffer.putLong(record.getTime());
  for (int i=0; i < metricNames.size(); i++) {
    int metricValue=record.getMetricValues().get(metricNames.get(i));
    if (time == record.getTime()) {
      buffer.putInt(metrics[i] + metricValue);
    }
 else {
      buffer.putInt(metricValue);
    }
  }
}
