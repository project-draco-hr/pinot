{
synchronized (sync) {
    List<StarTreeRecord> list=new LinkedList<StarTreeRecord>();
    buffer.clear();
    int[] currentDimensions=new int[dimensionNames.size()];
    long[] currentMetrics=new long[metricNames.size()];
    while (buffer.position() < buffer.limit()) {
      getDimensions(currentDimensions);
      Map<String,String> values=translateDimensions(currentDimensions);
      for (int i=0; i < numTimeBuckets; i++) {
        long time=getMetrics(currentMetrics);
        StarTreeRecordImpl.Builder builder=new StarTreeRecordImpl.Builder();
        builder.setDimensionValues(values).setTime(time);
        for (int j=0; j < metricNames.size(); j++) {
          builder.setMetricValue(metricNames.get(j),currentMetrics[j]);
        }
        list.add(builder.build());
      }
    }
    return list.iterator();
  }
}
