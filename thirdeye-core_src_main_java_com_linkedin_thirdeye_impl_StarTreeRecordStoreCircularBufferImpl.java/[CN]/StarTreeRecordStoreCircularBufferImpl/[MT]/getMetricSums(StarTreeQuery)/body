{
synchronized (sync) {
    Number[] sums=new Number[metricNames.size()];
    Set<Long> timeBuckets=getTimeBuckets(query);
    int[] targetDimensions=translateDimensions(query.getDimensionValues());
    int idx=binarySearch(targetDimensions);
    if (idx >= 0) {
      buffer.clear();
      buffer.position(idx + dimensionSize);
      updateSums(sums,timeBuckets);
    }
 else {
      buffer.clear();
      int[] currentDimensions=new int[dimensionNames.size()];
      while (buffer.position() < buffer.limit()) {
        buffer.mark();
        getDimensions(currentDimensions);
        if (matches(targetDimensions,currentDimensions)) {
          updateSums(sums,timeBuckets);
        }
        buffer.reset();
        buffer.position(buffer.position() + entrySize);
      }
    }
    return sums;
  }
}
