{
  LOG.info("running the Dashboard application with configs, {}",config.toString());
  ExecutorService queryExecutor=environment.lifecycle().executorService("query_executor").build();
  String clientConfigFilePath=config.getClientConfigRoot();
  CollectionMapThirdEyeClient clientMap=CollectionMapThirdEyeClient.fromFolder(clientConfigFilePath);
  DataCache dataCache=new DataCache(clientMap);
  QueryCache queryCache=new QueryCache(clientMap,queryExecutor);
  ConfigCache configCache=new ConfigCache();
  CustomDashboardResource customDashboardResource=null;
  if (config.getCustomDashboardRoot() != null) {
    File customDashboardDir=new File(config.getCustomDashboardRoot());
    configCache.setCustomDashboardRoot(customDashboardDir);
    customDashboardResource=new CustomDashboardResource(customDashboardDir,queryCache,dataCache,configCache);
    environment.jersey().register(customDashboardResource);
  }
  FunnelsDataProvider funnelsResource=null;
  if (config.getFunnelConfigRoot() != null) {
    funnelsResource=new FunnelsDataProvider(new File(config.getFunnelConfigRoot()),queryCache,dataCache);
    environment.jersey().register(funnelsResource);
  }
  if (config.getCollectionConfigRoot() != null) {
    File collectionConfigDir=new File(config.getCollectionConfigRoot());
    configCache.setCollectionConfigRoot(collectionConfigDir);
    CollectionConfigResource collectionConfigResource=new CollectionConfigResource(collectionConfigDir,configCache);
    environment.jersey().register(collectionConfigResource);
  }
  DashboardConfigResource dashboardConfigResource=new DashboardConfigResource(dataCache,queryCache,clientMap,clientConfigFilePath,environment.getObjectMapper());
  environment.jersey().register(dashboardConfigResource);
  ContributorDataProvider contributorResource=new ContributorDataProvider(queryCache,environment.getObjectMapper());
  environment.jersey().register(contributorResource);
  environment.jersey().register(new DashboardResource(dataCache,config.getFeedbackEmailAddress(),queryCache,environment.getObjectMapper(),customDashboardResource,configCache,funnelsResource,contributorResource,dashboardConfigResource));
  environment.jersey().register(new FlotTimeSeriesResource(dataCache,queryCache,environment.getObjectMapper(),configCache,config.getAnomalyDatabaseConfig()));
  environment.jersey().register(new MetadataResource(dataCache));
  environment.admin().addTask(new ClearCachesTask(dataCache,queryCache,configCache));
}
