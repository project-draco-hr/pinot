{
  LOG.info("running the Dashboard application with configs, {}",config.toString());
  final HttpClient httpClient=new HttpClientBuilder(environment).using(config.getHttpClient()).build(getName());
  ExecutorService queryExecutor=environment.lifecycle().executorService("query_executor").build();
  ConfigCache configCache=new ConfigCache();
  DataCache dataCache=new DataCache(httpClient,environment.getObjectMapper());
  QueryCache queryCache=new QueryCache(httpClient,environment.getObjectMapper(),queryExecutor);
  CustomDashboardResource customDashboardResource=null;
  if (config.getCustomDashboardRoot() != null) {
    File customDashboardDir=new File(config.getCustomDashboardRoot());
    configCache.setCustomDashboardRoot(customDashboardDir);
    customDashboardResource=new CustomDashboardResource(customDashboardDir,config.getServerUri(),queryCache,dataCache,configCache);
    environment.jersey().register(customDashboardResource);
  }
  FunnelsDataProvider funnelsResource=null;
  if (config.getFunnelConfigRoot() != null) {
    funnelsResource=new FunnelsDataProvider(new File(config.getFunnelConfigRoot()),config.getServerUri(),queryCache,dataCache);
    environment.jersey().register(funnelsResource);
  }
  if (config.getCollectionConfigRoot() != null) {
    File collectionConfigDir=new File(config.getCollectionConfigRoot());
    configCache.setCollectionConfigRoot(collectionConfigDir);
    CollectionConfigResource collectionConfigResource=new CollectionConfigResource(collectionConfigDir,configCache);
    environment.jersey().register(collectionConfigResource);
  }
  DashboardConfigResource dashboardConfigResource=new DashboardConfigResource(config.getServerUri(),dataCache,queryCache,environment.getObjectMapper());
  environment.jersey().register(dashboardConfigResource);
  ContributorDataProvider contributorResource=new ContributorDataProvider(config.getServerUri(),queryCache,environment.getObjectMapper());
  environment.jersey().register(contributorResource);
  environment.jersey().register(new DashboardResource(config.getServerUri(),dataCache,config.getFeedbackEmailAddress(),queryCache,environment.getObjectMapper(),customDashboardResource,configCache,funnelsResource,contributorResource,dashboardConfigResource));
  environment.jersey().register(new FlotTimeSeriesResource(config.getServerUri(),dataCache,queryCache,environment.getObjectMapper(),configCache,config.getAnomalyDatabaseConfig()));
  environment.jersey().register(new MetadataResource(config.getServerUri(),dataCache));
  environment.admin().addTask(new ClearCachesTask(dataCache,queryCache,configCache));
}
