{
  final HttpClient httpClient=new HttpClientBuilder(environment).using(config.getHttpClient()).build(getName());
  ExecutorService queryExecutor=environment.lifecycle().executorService("query_executor").build();
  DataCache dataCache=new DataCache(httpClient,environment.getObjectMapper());
  QueryCache queryCache=new QueryCache(httpClient,environment.getObjectMapper(),queryExecutor);
  CustomDashboardResource customDashboardResource=null;
  if (config.getCustomDashboardRoot() != null) {
    File customDashboardDir=new File(config.getCustomDashboardRoot());
    customDashboardResource=new CustomDashboardResource(customDashboardDir,config.getServerUri(),queryCache,dataCache);
    environment.jersey().register(customDashboardResource);
  }
  environment.jersey().register(new DashboardResource(config.getServerUri(),dataCache,config.getFeedbackEmailAddress(),queryCache,environment.getObjectMapper(),customDashboardResource));
  environment.jersey().register(new FlotTimeSeriesResource(config.getServerUri(),dataCache,queryCache,environment.getObjectMapper()));
  environment.jersey().register(new MetadataResource(config.getServerUri(),dataCache));
  environment.admin().addTask(new ClearCachesTask(dataCache,queryCache));
}
