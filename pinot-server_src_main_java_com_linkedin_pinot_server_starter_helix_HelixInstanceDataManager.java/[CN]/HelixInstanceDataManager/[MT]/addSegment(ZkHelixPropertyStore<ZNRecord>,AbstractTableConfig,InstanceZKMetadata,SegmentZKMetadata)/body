{
  if (segmentZKMetadata == null || segmentZKMetadata.getResourceName() == null) {
    throw new RuntimeException("Error: adding invalid SegmentMetadata!");
  }
  LOGGER.info("Trying to add segment with name: " + segmentZKMetadata.getSegmentName());
  LOGGER.debug("Trying to add segment with Metadata: " + segmentZKMetadata.toString());
  String resourceName=segmentZKMetadata.getResourceName();
  if (segmentZKMetadata instanceof RealtimeSegmentZKMetadata) {
    resourceName=TableNameBuilder.REALTIME_TABLE_NAME_BUILDER.forTable(resourceName);
  }
 else   if (segmentZKMetadata instanceof OfflineSegmentZKMetadata) {
    resourceName=TableNameBuilder.OFFLINE_TABLE_NAME_BUILDER.forTable(resourceName);
  }
  if (!_resourceDataManagerMap.containsKey(resourceName)) {
    LOGGER.info("Trying to add ResourceDataManager for resource name: " + resourceName);
synchronized (_globalLock) {
      if (!_resourceDataManagerMap.containsKey(resourceName)) {
        addResourceIfNeed(tableConfig,resourceName);
      }
    }
  }
  _resourceDataManagerMap.get(resourceName).addSegment(propertyStore,tableConfig,instanceZKMetadata,segmentZKMetadata);
  LOGGER.info("Successfuly added a segment : " + segmentZKMetadata.getSegmentName() + " in HelixInstanceDataManager");
}
