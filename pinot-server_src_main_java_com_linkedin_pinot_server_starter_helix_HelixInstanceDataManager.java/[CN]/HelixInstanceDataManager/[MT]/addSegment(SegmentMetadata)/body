{
  if (segmentMetadata == null || segmentMetadata.getResourceName() == null) {
    throw new RuntimeException("Error: adding invalid SegmentMetadata!");
  }
  LOGGER.info("Trying to add segment with name: " + segmentMetadata.getName());
  LOGGER.debug("Trying to add segment with Metadata: " + segmentMetadata.toString());
  String resourceName=segmentMetadata.getResourceName();
  if (segmentMetadata.getIndexType().equalsIgnoreCase("realtime")) {
    resourceName=BrokerRequestUtils.getRealtimeResourceNameForResource(resourceName);
  }
 else {
    resourceName=BrokerRequestUtils.getOfflineResourceNameForResource(resourceName);
  }
  if (!_resourceDataManagerMap.containsKey(resourceName)) {
    LOGGER.info("Trying to add ResourceDataManager for resource name: " + resourceName);
synchronized (_globalLock) {
      if (!_resourceDataManagerMap.containsKey(resourceName)) {
        addResourceIfNeed(null,resourceName);
      }
    }
  }
  _resourceDataManagerMap.get(resourceName).addSegment(segmentMetadata);
  LOGGER.info("Successfuly added a segment : " + segmentMetadata.getName() + " in HelixInstanceDataManager");
}
