{
  if (segmentMetadata == null || segmentMetadata.getTableName() == null) {
    throw new RuntimeException("Error: adding invalid SegmentMetadata!");
  }
  LOGGER.info("Trying to add segment with name: " + segmentMetadata.getName());
  LOGGER.debug("Trying to add segment with Metadata: " + segmentMetadata.toString());
  String tableName=segmentMetadata.getTableName();
  if (segmentMetadata.getIndexType().equalsIgnoreCase("realtime")) {
    tableName=TableNameBuilder.REALTIME_TABLE_NAME_BUILDER.forTable(tableName);
  }
 else {
    tableName=TableNameBuilder.OFFLINE_TABLE_NAME_BUILDER.forTable(tableName);
  }
  if (!_tableDataManagerMap.containsKey(tableName)) {
    LOGGER.info("Trying to add TableDataManager for table name: " + tableName);
synchronized (_globalLock) {
      if (!_tableDataManagerMap.containsKey(tableName)) {
        addTableIfNeed(null,tableName);
      }
    }
  }
  _tableDataManagerMap.get(tableName).addSegment(segmentMetadata);
  LOGGER.info("Successfuly added a segment : " + segmentMetadata.getName() + " in HelixInstanceDataManager");
}
