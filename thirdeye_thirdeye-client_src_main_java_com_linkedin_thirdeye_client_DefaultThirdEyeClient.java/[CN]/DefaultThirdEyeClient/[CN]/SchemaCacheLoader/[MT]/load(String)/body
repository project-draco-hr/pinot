{
  HttpGet req=new HttpGet(COLLECTIONS_ENDPOINT + URLEncoder.encode(collection,UTF_8));
  LOG.info("Loading metric schema: {}",req);
  CloseableHttpResponse res=httpClient.execute(httpHost,req);
  try {
    if (res.getStatusLine().getStatusCode() != 200) {
      throw new IllegalStateException(res.getStatusLine().toString());
    }
    InputStream content=res.getEntity().getContent();
    JsonNode json=OBJECT_MAPPER.readTree(content);
    Map<String,MetricType> metricTypes=new HashMap<>();
    for (    JsonNode metricSpec : json.get("metrics")) {
      String metricName=metricSpec.get("name").asText();
      MetricType metricType=MetricType.valueOf(metricSpec.get("type").asText());
      metricTypes.put(metricName,metricType);
    }
    LOG.info("Cached metric types for {}: {}",collection,metricTypes);
    return metricTypes;
  }
  finally {
    if (res.getEntity() != null) {
      EntityUtils.consume(res.getEntity());
    }
    res.close();
  }
}
