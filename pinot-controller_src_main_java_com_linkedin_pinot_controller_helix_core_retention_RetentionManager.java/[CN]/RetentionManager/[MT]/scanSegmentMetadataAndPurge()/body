{
  for (  String resourceName : _segmentMetadataMap.keySet()) {
    List<SegmentZKMetadata> segmentZKMetadataList=_segmentMetadataMap.get(resourceName);
    for (    SegmentZKMetadata segmentZKMetadata : segmentZKMetadataList) {
      RetentionStrategy deletionStrategy;
      if (_tableDeletionStrategy.containsKey(resourceName + "." + segmentZKMetadata.getTableName())) {
        deletionStrategy=_tableDeletionStrategy.get(resourceName + "." + segmentZKMetadata.getTableName());
      }
 else {
        deletionStrategy=_tableDeletionStrategy.get(resourceName + ".*");
      }
      if (deletionStrategy == null) {
        LOGGER.info("No Retention strategy found for segment: " + segmentZKMetadata.getSegmentName());
        continue;
      }
      if (segmentZKMetadata instanceof RealtimeSegmentZKMetadata) {
        if (((RealtimeSegmentZKMetadata)segmentZKMetadata).getStatus() == Status.IN_PROGRESS) {
          continue;
        }
      }
      if (deletionStrategy.isPurgeable(segmentZKMetadata)) {
        LOGGER.info("Trying to delete segment: " + segmentZKMetadata.getSegmentName());
        _pinotHelixResourceManager.deleteSegment(resourceName,segmentZKMetadata.getSegmentName());
      }
    }
  }
}
