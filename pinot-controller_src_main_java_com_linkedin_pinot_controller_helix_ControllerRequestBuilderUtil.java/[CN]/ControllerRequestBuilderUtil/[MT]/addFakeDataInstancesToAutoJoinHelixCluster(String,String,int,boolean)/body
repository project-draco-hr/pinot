{
  for (int i=0; i < numInstances; ++i) {
    final String instanceId="Server_localhost_" + i;
    final HelixManager helixZkManager=HelixManagerFactory.getZKHelixManager(helixClusterName,instanceId,InstanceType.PARTICIPANT,zkServer);
    final StateMachineEngine stateMachineEngine=helixZkManager.getStateMachineEngine();
    final StateModelFactory<?> stateModelFactory=new EmptySegmentOnlineOfflineStateModelFactory();
    stateMachineEngine.registerStateModelFactory(EmptySegmentOnlineOfflineStateModelFactory.getStateModelDef(),stateModelFactory);
    helixZkManager.connect();
    if (isSingleTenant) {
      helixZkManager.getClusterManagmentTool().addInstanceTag(helixClusterName,instanceId,TableNameBuilder.OFFLINE_TABLE_NAME_BUILDER.forTable(ControllerTenantNameBuilder.DEFAULT_TENANT_NAME));
      helixZkManager.getClusterManagmentTool().addInstanceTag(helixClusterName,instanceId,TableNameBuilder.REALTIME_TABLE_NAME_BUILDER.forTable(ControllerTenantNameBuilder.DEFAULT_TENANT_NAME));
    }
 else {
      helixZkManager.getClusterManagmentTool().addInstanceTag(helixClusterName,instanceId,UNTAGGED_SERVER_INSTANCE);
    }
  }
}
