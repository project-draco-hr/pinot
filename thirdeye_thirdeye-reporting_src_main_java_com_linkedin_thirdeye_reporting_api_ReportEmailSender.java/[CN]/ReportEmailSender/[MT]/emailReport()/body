{
  try {
    FileTemplateLoader ftl=new FileTemplateLoader(new File(templatePath));
    Configuration emailConfiguration=new Configuration();
    emailConfiguration.setTemplateLoader(ftl);
    Template emailReportTemplate=emailConfiguration.getTemplate(scheduleSpec.getEmailTemplate());
    Map<String,Object> rootMap=new HashMap<String,Object>();
    rootMap.put(ReportConstants.REPORT_CONFIG_OBJECT,reportConfig);
    rootMap.put(ReportConstants.TABLES_OBJECT,tables);
    rootMap.put(ReportConstants.ANOMALY_TABLES_OBJECT,anomalyReportTables);
    rootMap.put(ReportConstants.MISSING_SEGMENTS_OBJECT,missingSegments);
    rootMap.put(ReportConstants.SCHEDULE_SPEC_OBJECT,scheduleSpec);
    Writer emailOutput=new StringWriter();
    emailReportTemplate.process(rootMap,emailOutput);
    Properties props=new Properties();
    props.setProperty(ReportConstants.MAIL_SMTP_HOST_KEY,ReportConstants.MAIL_SMTP_HOST_VALUE);
    Session session=Session.getDefaultInstance(props,null);
    Message emailReportMessage=new MimeMessage(session);
    for (    String emailIdFrom : scheduleSpec.getEmailFrom().split(",")) {
      emailReportMessage.setFrom(new InternetAddress(emailIdFrom,scheduleSpec.getNameFrom()));
    }
    for (    String emailIdTo : scheduleSpec.getEmailTo().split(",")) {
      emailReportMessage.addRecipient(Message.RecipientType.TO,new InternetAddress(emailIdTo,scheduleSpec.getNameTo()));
    }
    emailReportMessage.setSubject(ReportConstants.REPORT_SUBJECT_PREFIX + " " + reportConfig.getCollection().toUpperCase()+ " ("+ reportConfig.getEndTimeString()+ ") "+ reportConfig.getName());
    emailReportMessage.setContent(emailOutput.toString(),"text/html");
    LOGGER.info("Sending email from {} to {}  ",scheduleSpec.getEmailFrom(),scheduleSpec.getEmailTo());
    Transport.send(emailReportMessage);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
