{
  LOGGER.debug("SegmentOnlineOfflineStateModel.onBecomeOnlineFromOffline() : " + message);
  final String segmentId=message.getPartitionName();
  final String resourceName=message.getResourceName();
  final String pathToPropertyStore="/" + StringUtil.join("/",resourceName,segmentId);
  final ZNRecord record=context.getManager().getHelixPropertyStore().get(pathToPropertyStore,null,AccessOption.PERSISTENT);
  LOGGER.info("Trying to load segment : " + segmentId + " for resource : "+ resourceName);
  try {
    SegmentMetadata segmentMetadataForCheck=new SegmentMetadataImpl(record);
    SegmentMetadata segmentMetadataFromServer=INSTANCE_DATA_MANAGER.getSegmentMetadata(resourceName,segmentMetadataForCheck.getName());
    if (segmentMetadataFromServer == null) {
      final String localSegmentDir=new File(new File(INSTANCE_DATA_MANAGER.getSegmentDataDirectory(),resourceName),segmentId).toString();
      if (new File(localSegmentDir).exists()) {
        LOGGER.info("Cannot get segmentMetadata from Server will try to load from disk!");
        segmentMetadataFromServer=SEGMENT_METADATA_LOADER.loadIndexSegmentMetadataFromDir(localSegmentDir);
        INSTANCE_DATA_MANAGER.addSegment(segmentMetadataFromServer);
      }
    }
    if (isNewSegmentMetadata(segmentMetadataFromServer,segmentMetadataForCheck)) {
      LOGGER.info("Segment is new, will refresh it.");
      final String uri=record.getSimpleField(V1Constants.SEGMENT_DOWNLOAD_URL);
      final String localSegmentDir=downloadSegmentToLocal(uri,resourceName,segmentId);
      final SegmentMetadata segmentMetadata=SEGMENT_METADATA_LOADER.loadIndexSegmentMetadataFromDir(localSegmentDir);
      INSTANCE_DATA_MANAGER.addSegment(segmentMetadata);
    }
 else {
      LOGGER.info("Segment is already existed, will do nothing.");
    }
  }
 catch (  final Exception e) {
    e.printStackTrace();
    LOGGER.error("Cannot load segment : " + segmentId + "!\n",e);
  }
}
