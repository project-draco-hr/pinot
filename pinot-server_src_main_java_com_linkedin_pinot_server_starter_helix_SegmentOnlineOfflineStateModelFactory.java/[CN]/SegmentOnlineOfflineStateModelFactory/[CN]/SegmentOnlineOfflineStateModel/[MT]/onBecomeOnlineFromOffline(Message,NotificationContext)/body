{
  System.out.println("SegmentOnlineOfflineStateModel.onBecomeOnlineFromOffline() : " + message);
  final String segmentId=message.getPartitionName();
  final String resourceName=message.getResourceName();
  final String pathToPropertyStore="/" + StringUtil.join("/",resourceName,segmentId);
  final ZNRecord record=context.getManager().getHelixPropertyStore().get(pathToPropertyStore,null,AccessOption.PERSISTENT);
  LOGGER.info("Trying to load segment : " + segmentId + " for resource : "+ resourceName);
  try {
    SegmentMetadata segmentMetadataForCheck=new SegmentMetadataImpl(record);
    SegmentMetadata segmentMetadataFromServer=INSTANCE_DATA_MANAGER.getSegmentMetadata(resourceName,segmentMetadataForCheck.getName());
    if (!isNewSegmentMetadata(segmentMetadataFromServer,segmentMetadataForCheck)) {
      LOGGER.info("Segment is already existed, will do nothing.");
    }
    final String uri=record.getSimpleField(V1Constants.SEGMENT_DOWNLOAD_URL);
    final String localSegmentDir=downloadSegmentToLocal(uri,resourceName,segmentId);
    final SegmentMetadata segmentMetadata=SEGMENT_METADATA_LOADER.loadIndexSegmentMetadataFromDir(localSegmentDir);
    INSTANCE_DATA_MANAGER.addSegment(segmentMetadata);
  }
 catch (  final Exception e) {
    e.printStackTrace();
    LOGGER.error("Cannot load segment : " + segmentId + "!\n",e);
  }
}
