{
  for (  String collection : manager.getCollections()) {
    final String collectionName=collection;
    lastPostDataMillis.putIfAbsent(collection,new AtomicLong(System.currentTimeMillis()));
    metricRegistry.register(MetricRegistry.name(CollectionsResource.class,collection,LAST_POST_DATA_MILLIS),new Gauge<Long>(){
      @Override public Long getValue(){
        return lastPostDataMillis.get(collectionName).get();
      }
    }
);
    metricRegistry.register(MetricRegistry.name(CollectionsResource.class,collection,DATA_TIME_LAG_MILLIS),new Gauge<Long>(){
      @Override public Long getValue(){
        return System.currentTimeMillis() - manager.getMaxDataTime(collectionName);
      }
    }
);
  }
}
