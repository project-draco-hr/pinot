{
  DateTime minTime=new DateTime(minTimeMillis,DateTimeZone.UTC);
  DateTime maxTime=new DateTime(maxTimeMillis,DateTimeZone.UTC);
  LOG.info("Received data for {} in {} to {}",collection,minTime,maxTime);
  LOG.info("Deleting older segment for same date range, if exists");
  dataUpdateManager.deleteData(collection,schedule,minTime,maxTime);
  dataUpdateManager.updateData(collection,schedule,minTime,maxTime,dataBytes);
  final String collectionName=collection;
  AtomicLong value=lastPostDataMillis.putIfAbsent(collectionName,new AtomicLong(System.currentTimeMillis()));
  if (value == null) {
    metricRegistry.register(MetricRegistry.name(CollectionsResource.class,collectionName,LAST_POST_DATA_MILLIS),new Gauge<Long>(){
      @Override public Long getValue(){
        return lastPostDataMillis.get(collectionName).get();
      }
    }
);
  }
 else {
    value.set((System.currentTimeMillis()));
  }
  if (!metricRegistry.getGauges().containsKey(MetricRegistry.name(CollectionsResource.class,collection,DATA_TIME_LAG_MILLIS))) {
    metricRegistry.register(MetricRegistry.name(CollectionsResource.class,collection,DATA_TIME_LAG_MILLIS),new Gauge<Long>(){
      @Override public Long getValue(){
        Long maxDataTime=manager.getMaxDataTime(collectionName);
        if (maxDataTime == null) {
          maxDataTime=0L;
        }
        return System.currentTimeMillis() - maxDataTime;
      }
    }
);
  }
  return Response.ok().build();
}
