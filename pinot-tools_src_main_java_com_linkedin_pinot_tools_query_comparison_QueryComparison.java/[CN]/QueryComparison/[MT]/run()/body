{
  startCluster();
  String query;
  ScanBasedQueryProcessor scanBasedQueryProcessor=null;
  BufferedReader resultReader=null;
  BufferedReader queryReader=new BufferedReader(new FileReader(_queryFile));
  if (_resultFile == null) {
    scanBasedQueryProcessor=new ScanBasedQueryProcessor(_segmentsDir.getAbsolutePath());
  }
 else {
    resultReader=new BufferedReader(new FileReader(_resultFile));
  }
  int passed=0;
  int total=0;
  while ((query=queryReader.readLine()) != null) {
    if (query.isEmpty() || query.startsWith("#")) {
      continue;
    }
    try {
      JSONObject scanJson;
      if (resultReader != null) {
        scanJson=new JSONObject(resultReader.readLine());
      }
 else {
        QueryResponse scanResponse=scanBasedQueryProcessor.processQuery(query);
        scanJson=new JSONObject(new ObjectMapper().writeValueAsString(scanResponse));
      }
      String clusterResponse=_clusterStarter.query(query);
      JSONObject clusterJson=new JSONObject(clusterResponse);
      if (compare(clusterJson,scanJson)) {
        ++passed;
        LOGGER.info("Comparison PASSED: Id: {} Cluster Time: {} ms Scan Time: {} ms Docs Scanned: {}",total,clusterJson.get(TIME_USED_MS),scanJson.get(TIME_USED_MS),clusterJson.get(NUM_DOCS_SCANNED));
        LOGGER.debug("Cluster Result: {}",clusterJson);
        LOGGER.debug("Scan Result: {}",scanJson);
      }
 else {
        LOGGER.error("Comparison FAILED: {}",query);
        LOGGER.info("Cluster Response: {}",clusterJson);
        LOGGER.info("Scan Response: {}",scanJson);
      }
    }
 catch (    Exception e) {
      LOGGER.error("Exception caught while processing query: '{}'",query,e);
    }
 finally {
      ++total;
    }
  }
  LOGGER.info("Total {} out of {} queries passed.",passed,total);
}
