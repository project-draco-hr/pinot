{
  startCluster();
  String query;
  ScanBasedQueryProcessor scanBasedQueryProcessor=new ScanBasedQueryProcessor(_segmentsDir.getAbsolutePath());
  BufferedReader queryReader=new BufferedReader(new FileReader(_queryFile));
  BufferedReader resultReader=(_resultFile != null) ? new BufferedReader(new FileReader(_resultFile)) : null;
  int passed=0;
  int total=0;
  while ((query=queryReader.readLine()) != null) {
    if (query.isEmpty() || query.startsWith("#")) {
      continue;
    }
    try {
      JSONObject scanJson;
      if (resultReader != null) {
        scanJson=new JSONObject(resultReader.readLine());
      }
 else {
        QueryResponse scanResponse=scanBasedQueryProcessor.processQuery(query);
        scanJson=new JSONObject(new ObjectMapper().writeValueAsString(scanResponse));
      }
      String clusterResponse=_clusterStarter.query(query);
      JSONObject clusterJson=new JSONObject(clusterResponse);
      if (compare(clusterJson,scanJson)) {
        ++passed;
        LOGGER.info("Comparison PASSED: Scan Time: {} ms Query: {}",scanJson.get(TIME_USED_MS),query);
        LOGGER.info("Cluster Result: {}",clusterJson);
      }
 else {
        LOGGER.error("Comparison FAILED: {}",query);
        LOGGER.info("Cluster Response: {}",clusterJson);
        LOGGER.info("Scan Response: {}",scanJson);
      }
      ++total;
    }
 catch (    Exception e) {
      LOGGER.error("Exception caught while processing query: '{}'",query,e);
    }
  }
  LOGGER.info("Total {} out of {} queries passed.",passed,total);
}
