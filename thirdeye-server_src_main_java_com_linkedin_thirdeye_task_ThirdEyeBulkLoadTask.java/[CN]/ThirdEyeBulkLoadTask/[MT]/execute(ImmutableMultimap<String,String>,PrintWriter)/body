{
  Collection<String> collectionParam=params.get("collection");
  if (collectionParam == null || collectionParam.isEmpty()) {
    throw new IllegalArgumentException("Must provide collection");
  }
  String collection=collectionParam.iterator().next();
  StarTree starTree=manager.getStarTree(collection);
  if (starTree == null) {
    throw new IllegalArgumentException("No star tree for collection " + collection);
  }
  String type=AVRO;
  if (!params.get(TYPE).isEmpty()) {
    type=params.get(TYPE).iterator().next();
  }
  StarTreeBulkLoader bulkLoader;
  if (AVRO.equals(type)) {
    bulkLoader=new StarTreeBulkLoaderAvroImpl(executorService,printWriter);
  }
 else {
    throw new IllegalArgumentException("Invalid file type " + type);
  }
  File collectionRootDir=new File(rootDir,starTree.getConfig().getCollection());
  File collectionTmpDir=new File(tmpDir,starTree.getConfig().getCollection());
  bulkLoader.bulkLoad(starTree,collectionRootDir,collectionTmpDir);
}
