{
  Collection<String> actionParam=params.get("action");
  if (actionParam == null || actionParam.isEmpty()) {
    throw new IllegalArgumentException("Must provide action (execute|cleanup)");
  }
  String action=actionParam.iterator().next();
  Collection<String> collectionParam=params.get("collection");
  if (collectionParam == null || collectionParam.isEmpty()) {
    throw new IllegalArgumentException("Must provide collection");
  }
  String collection=collectionParam.iterator().next();
  String type=AVRO;
  if (!params.get(TYPE).isEmpty()) {
    type=params.get(TYPE).iterator().next();
  }
  if (ACTION_EXECUTE.equals(action)) {
    doExecute(collection,type,printWriter);
  }
 else   if (ACTION_CLEANUP.equals(action)) {
    doCleanup(collection,printWriter);
  }
 else {
    throw new IllegalArgumentException("Unsupported action " + action);
  }
}
