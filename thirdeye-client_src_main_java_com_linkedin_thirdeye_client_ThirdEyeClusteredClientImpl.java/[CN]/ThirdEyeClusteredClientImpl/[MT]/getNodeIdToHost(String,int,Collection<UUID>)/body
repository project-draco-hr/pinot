{
  Map<UUID,HttpHost> nodeIdToHost=new HashMap<UUID,HttpHost>(nodeIds.size());
  for (  UUID nodeId : nodeIds) {
    String partitionName=String.format("%s_%d",collection,StarTreeUtils.getPartitionId(nodeId,numPartitions));
    List<InstanceConfig> instances=routingTable.getInstances(collection,partitionName,ONLINE.toString());
    if (instances == null || instances.isEmpty()) {
      throw new IllegalStateException("No ONLINE replica of " + partitionName + " for "+ nodeId);
    }
    InstanceConfig instance=instances.iterator().next();
    String[] hostPort=instance.getInstanceName().split("_");
    nodeIdToHost.put(nodeId,new HttpHost(hostPort[0],Integer.valueOf(hostPort[1])));
  }
  return nodeIdToHost;
}
