{
  Options options=new Options();
  options.addOption("fileType",true,"File type (avro|tsv)");
  options.addOption("keepMetricValues",false,"Keep metric values in buffers (default: false)");
  options.addOption("keepBuffers",false,"Generate buffers (default: false)");
  CommandLine commandLine=new GnuParser().parse(options,args);
  if (commandLine.getArgs().length < 5) {
    HelpFormatter helpFormatter=new HelpFormatter();
    helpFormatter.printHelp("usage: [opts] config.json startTime endTime outputDir inputFile ...",options);
    return;
  }
  String configJson=commandLine.getArgs()[0];
  Long startTime=Long.valueOf(commandLine.getArgs()[1]);
  Long endTime=Long.valueOf(commandLine.getArgs()[2]);
  String outputDir=commandLine.getArgs()[3];
  String[] inputFiles=Arrays.copyOfRange(commandLine.getArgs(),4,commandLine.getArgs().length);
  String fileType=commandLine.getOptionValue("fileType","tsv");
  Boolean keepMetricValues=commandLine.hasOption("keepMetricValues");
  StarTreeConfig config=StarTreeConfig.fromJson(OBJECT_MAPPER.readTree(new File(configJson)));
  List<Iterable<StarTreeRecord>> recordStreams=new ArrayList<Iterable<StarTreeRecord>>();
  if ("avro".equals(fileType)) {
    for (    String inputFile : inputFiles) {
      recordStreams.add(new StarTreeRecordStreamAvroFileImpl(new File(inputFile),config.getDimensionNames(),config.getMetricNames(),config.getTimeColumnName()));
    }
  }
 else   if ("tsv".equals(fileType)) {
    for (    String inputFile : inputFiles) {
      recordStreams.add(new StarTreeRecordStreamTextStreamImpl(new FileInputStream(inputFile),config.getDimensionNames(),config.getMetricNames(),"\t"));
    }
  }
 else {
    throw new IllegalArgumentException("Invalid file type " + fileType);
  }
  new StarTreeBootstrapTool(startTime,endTime,keepMetricValues,config,recordStreams,new File(outputDir)).run();
}
